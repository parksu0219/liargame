/*! For license information please see 6a4fd280-39ab637e32130a5e08cc.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{NQNo:function(t,e,n){"use strict";(function(t){n("E9XD"),Object.defineProperty(e,"__esModule",{value:!0});var r,i=n("UNrv"),o=(r=n("eBTZ"))&&"object"==typeof r&&"default"in r?r.default:r,s=n("NqFF"),u=n("ECPB"),a=n("dd2w"),c=n("2K/g"),h=new s.Logger("@firebase/firestore");function f(){return h.logLevel}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=s.LogLevel.DEBUG){var r=e.map(y);h.debug.apply(h,i.__spreadArrays(["Firestore (7.17.2): "+t],r))}}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=s.LogLevel.ERROR){var r=e.map(y);h.error.apply(h,i.__spreadArrays(["Firestore (7.17.2): "+t],r))}}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=s.LogLevel.WARN){var r=e.map(y);h.warn.apply(h,i.__spreadArrays(["Firestore (7.17.2): "+t],r))}}function y(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function v(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.17.2) INTERNAL ASSERTION FAILED: "+t;throw p(e),new Error(e)}function g(t,e){t||v()}function m(t,e){return t}function w(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var b=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=w(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function _(t,e){return t<e?-1:t>e?1:0}function I(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function E(t){return t+"\0"}var T=function(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},N=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.o=function(t){return _(this.projectId,t.projectId)||_(this.database,t.database)},t}();function A(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function k(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function D(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var x=function(){function t(t,e){this.h=t,this.u=e,this.l={}}return t.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){k(this.l,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype._=function(){return D(this.l)},t}(),S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},P=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return i.__extends(e,t),e}(Error),L=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new P(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new P(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new P(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new P(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.T=function(t){return this.seconds===t.seconds?_(this.nanoseconds,t.nanoseconds):_(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),O=function(){function t(t){this.timestamp=t}return t.I=function(e){return new t(e)},t.min=function(){return new t(new L(0,0))},t.prototype.o=function(t){return this.timestamp.T(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.A=function(){return this.timestamp},t}(),R=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&v(),void 0===n?n=t.length-e:n>t.length-e&&v(),this.segments=t,this.offset=e,this.R=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.P(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.g(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.V=function(t){return t=void 0===t?1:t,this.g(this.segments,this.offset+t,this.length-t)},t.prototype.p=function(){return this.g(this.segments,this.offset,this.length-1)},t.prototype.v=function(){return this.segments[this.offset]},t.prototype.S=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype._=function(){return 0===this.length},t.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.F=function(){return this.segments.slice(this.offset,this.limit())},t.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.g=function(t,n,r){return new e(t,n,r)},e.prototype.N=function(){return this.F().join("/")},e.prototype.toString=function(){return this.N()},e.k=function(t){if(t.indexOf("//")>=0)throw new P(S.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter((function(t){return t.length>0})))},e.$=function(){return new e([])},e}(R),C=/^[_a-zA-Z][_a-zA-Z0-9]*$/,U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.g=function(t,n,r){return new e(t,n,r)},e.M=function(t){return C.test(t)},e.prototype.N=function(){return this.F().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.M(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.N()},e.prototype.O=function(){return 1===this.length&&"__name__"===this.get(0)},e.L=function(){return new e(["__name__"])},e.q=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new P(S.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new P(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new P(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new P(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.$=function(){return new e([])},e}(R),q=function(){function t(t){this.path=t}return t.B=function(e){return new t(V.k(e).V(5))},t.prototype.U=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===V.P(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.P=function(t,e){return V.P(t.path,e.path)},t.W=function(t){return t.length%2==0},t.j=function(e){return new t(new V(e.slice()))},t}();function M(t){return null==t}function F(t){return-0===t&&1/t==-1/0}function j(t){return"number"==typeof t&&Number.isInteger(t)&&!F(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var B=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.K=null};function G(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new B(t,e,n,r,i,o,s)}function z(t){var e=m(t);if(null===e.K){var n=e.path.N();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.N()+t.op.toString()+Vt(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.N()+e.dir;var e})).join(","),M(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=xn(e.startAt)),e.endAt&&(n+="|ub:",n+=xn(e.endAt)),e.K=n}return e.K}function Q(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Rn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Pt(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Pn(t.startAt,e.startAt)&&Pn(t.endAt,e.endAt)}function K(t){return q.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}var W=function(){function t(t){this.G=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.G,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.G)},t.prototype.H=function(){return 2*this.G.length},t.prototype.o=function(t){return _(this.G,t.G)},t.prototype.isEqual=function(t){return this.G===t.G},t}();W.Y=new W("");var H,Y,X=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=O.min()),void 0===o&&(o=O.min()),void 0===s&&(s=W.Y),this.target=t,this.targetId=e,this.J=n,this.sequenceNumber=r,this.X=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.Z=function(e){return new t(this.target,this.targetId,this.J,e,this.X,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.tt=function(e,n){return new t(this.target,this.targetId,this.J,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.et=function(e){return new t(this.target,this.targetId,this.J,this.sequenceNumber,this.X,e,this.resumeToken)},t}(),$=function(t){this.count=t};function Z(t){switch(t){case S.OK:return v();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return v()}}function J(t){if(void 0===t)return p("GRPC error has no .code"),S.UNKNOWN;switch(t){case H.OK:return S.OK;case H.CANCELLED:return S.CANCELLED;case H.UNKNOWN:return S.UNKNOWN;case H.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case H.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case H.INTERNAL:return S.INTERNAL;case H.UNAVAILABLE:return S.UNAVAILABLE;case H.UNAUTHENTICATED:return S.UNAUTHENTICATED;case H.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case H.NOT_FOUND:return S.NOT_FOUND;case H.ALREADY_EXISTS:return S.ALREADY_EXISTS;case H.PERMISSION_DENIED:return S.PERMISSION_DENIED;case H.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case H.ABORTED:return S.ABORTED;case H.OUT_OF_RANGE:return S.OUT_OF_RANGE;case H.UNIMPLEMENTED:return S.UNIMPLEMENTED;case H.DATA_LOSS:return S.DATA_LOSS;default:return v()}}(Y=H||(H={}))[Y.OK=0]="OK",Y[Y.CANCELLED=1]="CANCELLED",Y[Y.UNKNOWN=2]="UNKNOWN",Y[Y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Y[Y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Y[Y.NOT_FOUND=5]="NOT_FOUND",Y[Y.ALREADY_EXISTS=6]="ALREADY_EXISTS",Y[Y.PERMISSION_DENIED=7]="PERMISSION_DENIED",Y[Y.UNAUTHENTICATED=16]="UNAUTHENTICATED",Y[Y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Y[Y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Y[Y.ABORTED=10]="ABORTED",Y[Y.OUT_OF_RANGE=11]="OUT_OF_RANGE",Y[Y.UNIMPLEMENTED=12]="UNIMPLEMENTED",Y[Y.INTERNAL=13]="INTERNAL",Y[Y.UNAVAILABLE=14]="UNAVAILABLE",Y[Y.DATA_LOSS=15]="DATA_LOSS";var tt=function(){function t(t,e){this.P=t,this.root=e||nt.EMPTY}return t.prototype.nt=function(e,n){return new t(this.P,this.root.nt(e,n,this.P).copy(null,null,nt.st,null,null))},t.prototype.remove=function(e){return new t(this.P,this.root.remove(e,this.P).copy(null,null,nt.st,null,null))},t.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype._=function(){return this.root._()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.it=function(){return this.root.it()},t.prototype.rt=function(){return this.root.rt()},t.prototype.ot=function(t){return this.root.ot(t)},t.prototype.forEach=function(t){this.ot((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ot((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.at=function(){return new et(this.root,null,this.P,!1)},t.prototype.ut=function(t){return new et(this.root,t,this.P,!1)},t.prototype.ct=function(){return new et(this.root,null,this.P,!0)},t.prototype.lt=function(t){return new et(this.root,t,this.P,!0)},t}(),et=function(){function t(t,e,n,r){this._t=r,this.ft=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this._t?t.left:t.right;else{if(0===i){this.ft.push(t);break}this.ft.push(t),t=this._t?t.right:t.left}}return t.prototype.dt=function(){var t=this.ft.pop(),e={key:t.key,value:t.value};if(this._t)for(t=t.left;!t._();)this.ft.push(t),t=t.right;else for(t=t.right;!t._();)this.ft.push(t),t=t.left;return e},t.prototype.wt=function(){return this.ft.length>0},t.prototype.Tt=function(){if(0===this.ft.length)return null;var t=this.ft[this.ft.length-1];return{key:t.key,value:t.value}},t}(),nt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype._=function(){return!1},t.prototype.ot=function(t){return this.left.ot(t)||t(this.key,this.value)||this.right.ot(t)},t.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},t.prototype.min=function(){return this.left._()?this:this.left.min()},t.prototype.it=function(){return this.min().key},t.prototype.rt=function(){return this.right._()?this.key:this.right.rt()},t.prototype.nt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.nt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.nt(t,e,n))).Et()},t.prototype.It=function(){if(this.left._())return t.EMPTY;var e=this;return e.left.At()||e.left.left.At()||(e=e.Rt()),(e=e.copy(null,null,null,e.left.It(),null)).Et()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left._()||i.left.At()||i.left.left.At()||(i=i.Rt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.At()&&(i=i.Pt()),i.right._()||i.right.At()||i.right.left.At()||(i=i.gt()),0===n(e,i.key)){if(i.right._())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.It())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Et()},t.prototype.At=function(){return this.color},t.prototype.Et=function(){var t=this;return t.right.At()&&!t.left.At()&&(t=t.Vt()),t.left.At()&&t.left.left.At()&&(t=t.Pt()),t.left.At()&&t.right.At()&&(t=t.yt()),t},t.prototype.Rt=function(){var t=this.yt();return t.right.left.At()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Pt())).Vt()).yt()),t},t.prototype.gt=function(){var t=this.yt();return t.left.left.At()&&(t=(t=t.Pt()).yt()),t},t.prototype.Vt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.Pt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.yt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.pt=function(){var t=this.bt();return Math.pow(2,t)<=this.size+1},t.prototype.bt=function(){if(this.At()&&this.left.At())throw v();if(this.right.At())throw v();var t=this.left.bt();if(t!==this.right.bt())throw v();return t+(this.At()?0:1)},t}();nt.EMPTY=null,nt.RED=!0,nt.st=!1,nt.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw v()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.nt=function(t,e,n){return new nt(t,e)},t.prototype.remove=function(t,e){return this},t.prototype._=function(){return!0},t.prototype.ot=function(t){return!1},t.prototype.ht=function(t){return!1},t.prototype.it=function(){return null},t.prototype.rt=function(){return null},t.prototype.At=function(){return!1},t.prototype.pt=function(){return!0},t.prototype.bt=function(){return 0},t}());var rt=function(){function t(t){this.P=t,this.data=new tt(this.P)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.it()},t.prototype.last=function(){return this.data.rt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ot((function(e,n){return t(e),!1}))},t.prototype.vt=function(t,e){for(var n=this.data.ut(t[0]);n.wt();){var r=n.dt();if(this.P(r.key,t[1])>=0)return;e(r.key)}},t.prototype.St=function(t,e){var n;for(n=void 0!==e?this.data.ut(e):this.data.at();n.wt();)if(!t(n.dt().key))return},t.prototype.Dt=function(t){var e=this.data.ut(t);return e.wt()?e.dt().key:null},t.prototype.at=function(){return new it(this.data.at())},t.prototype.ut=function(t){return new it(this.data.ut(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).nt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype._=function(){return this.data._()},t.prototype.Ct=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.at(),r=e.data.at();n.wt();){var i=n.dt().key,o=r.dt().key;if(0!==this.P(i,o))return!1}return!0},t.prototype.F=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.P);return n.data=e,n},t}(),it=function(){function t(t){this.Ft=t}return t.prototype.dt=function(){return this.Ft.dt().key},t.prototype.wt=function(){return this.Ft.wt()},t}(),ot=new tt(q.P);function st(){return ot}function ut(){return st()}var at=new tt(q.P);function ct(){return at}var ht=new tt(q.P),ft=new rt(q.P);function lt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ft,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var pt=new rt(_);function dt(){return pt}var yt=function(){function t(t){this.P=t?function(e,n){return t(e,n)||q.P(e.key,n.key)}:function(t,e){return q.P(t.key,e.key)},this.Nt=ct(),this.kt=new tt(this.P)}return t.xt=function(e){return new t(e.P)},t.prototype.has=function(t){return null!=this.Nt.get(t)},t.prototype.get=function(t){return this.Nt.get(t)},t.prototype.first=function(){return this.kt.it()},t.prototype.last=function(){return this.kt.rt()},t.prototype._=function(){return this.kt._()},t.prototype.indexOf=function(t){var e=this.Nt.get(t);return e?this.kt.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.kt.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.kt.ot((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Nt.nt(t.key,t),e.kt.nt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Nt.remove(t),this.kt.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.kt.at(),r=e.kt.at();n.wt();){var i=n.dt().key,o=r.dt().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.P=this.P,r.Nt=e,r.kt=n,r},t}(),vt=function(){function t(){this.$t=new tt(q.P)}return t.prototype.track=function(t){var e=t.doc.key,n=this.$t.get(e);n?0!==t.type&&3===n.type?this.$t=this.$t.nt(e,t):3===t.type&&1!==n.type?this.$t=this.$t.nt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.$t=this.$t.nt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.$t=this.$t.nt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.$t=this.$t.remove(e):1===t.type&&2===n.type?this.$t=this.$t.nt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.$t=this.$t.nt(e,{type:2,doc:t.doc}):v():this.$t=this.$t.nt(e,t)},t.prototype.Mt=function(){var t=[];return this.$t.ot((function(e,n){t.push(n)})),t},t}(),gt=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ot=n,this.docChanges=r,this.Lt=i,this.fromCache=o,this.qt=s,this.Bt=u}return t.Ut=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,yt.xt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Lt._()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.qt===t.qt&&this.Lt.isEqual(t.Lt)&&gn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ot.isEqual(t.Ot)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),mt=function(){function t(t,e,n,r,i){this.X=t,this.Wt=e,this.Qt=n,this.jt=r,this.Kt=i}return t.Gt=function(e,n){var r=new Map;return r.set(e,wt.zt(e,n)),new t(O.min(),r,dt(),st(),lt())},t}(),wt=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Ht=e,this.Yt=n,this.Jt=r,this.Xt=i}return t.zt=function(e,n){return new t(W.Y,n,lt(),lt(),lt())},t}(),bt=function(t,e,n,r){this.Zt=t,this.removedTargetIds=e,this.key=n,this.te=r},_t=function(t,e){this.targetId=t,this.ee=e},It=function(t,e,n,r){void 0===n&&(n=W.Y),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Et=function(){function t(){this.ne=0,this.se=At(),this.ie=W.Y,this.re=!1,this.oe=!0}return Object.defineProperty(t.prototype,"Ht",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.ie},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"he",{get:function(){return 0!==this.ne},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ae",{get:function(){return this.oe},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){t.H()>0&&(this.oe=!0,this.ie=t)},t.prototype.ce=function(){var t=lt(),e=lt(),n=lt();return this.se.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:v()}})),new wt(this.ie,this.re,t,e,n)},t.prototype.le=function(){this.oe=!1,this.se=At()},t.prototype._e=function(t,e){this.oe=!0,this.se=this.se.nt(t,e)},t.prototype.fe=function(t){this.oe=!0,this.se=this.se.remove(t)},t.prototype.de=function(){this.ne+=1},t.prototype.we=function(){this.ne-=1},t.prototype.Te=function(){this.oe=!0,this.re=!0},t}(),Tt=function(){function t(t){this.Ee=t,this.Ie=new Map,this.me=st(),this.Ae=Nt(),this.Re=new rt(_)}return t.prototype.Pe=function(t){for(var e=0,n=t.Zt;e<n.length;e++){var r=n[e];t.te instanceof rn?this.ge(r,t.te):t.te instanceof on&&this.Ve(r,t.key,t.te)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Ve(s,t.key,t.te)}},t.prototype.ye=function(t){var e=this;this.pe(t,(function(n){var r=e.be(n);switch(t.state){case 0:e.ve(n)&&r.ue(t.resumeToken);break;case 1:r.we(),r.he||r.le(),r.ue(t.resumeToken);break;case 2:r.we(),r.he||e.removeTarget(n);break;case 3:e.ve(n)&&(r.Te(),r.ue(t.resumeToken));break;case 4:e.ve(n)&&(e.Se(n),r.ue(t.resumeToken));break;default:v()}}))},t.prototype.pe=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Ie.forEach((function(t,r){n.ve(r)&&e(r)}))},t.prototype.De=function(t){var e=t.targetId,n=t.ee.count,r=this.Ce(e);if(r){var i=r.target;if(K(i))if(0===n){var o=new q(i.path);this.Ve(e,o,new on(o,O.min()))}else g(1===n);else this.Fe(e)!==n&&(this.Se(e),this.Re=this.Re.add(e))}},t.prototype.Ne=function(t){var e=this,n=new Map;this.Ie.forEach((function(r,i){var o=e.Ce(i);if(o){if(r.Ht&&K(o.target)){var s=new q(o.target.path);null!==e.me.get(s)||e.ke(i,s)||e.Ve(i,s,new on(s,t))}r.ae&&(n.set(i,r.ce()),r.le())}}));var r=lt();this.Ae.forEach((function(t,n){var i=!0;n.St((function(t){var n=e.Ce(t);return!n||2===n.J||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new mt(t,n,this.Re,this.me,r);return this.me=st(),this.Ae=Nt(),this.Re=new rt(_),i},t.prototype.ge=function(t,e){if(this.ve(t)){var n=this.ke(t,e.key)?2:0;this.be(t)._e(e.key,n),this.me=this.me.nt(e.key,e),this.Ae=this.Ae.nt(e.key,this.xe(e.key).add(t))}},t.prototype.Ve=function(t,e,n){if(this.ve(t)){var r=this.be(t);this.ke(t,e)?r._e(e,1):r.fe(e),this.Ae=this.Ae.nt(e,this.xe(e).delete(t)),n&&(this.me=this.me.nt(e,n))}},t.prototype.removeTarget=function(t){this.Ie.delete(t)},t.prototype.Fe=function(t){var e=this.be(t).ce();return this.Ee.$e(t).size+e.Yt.size-e.Xt.size},t.prototype.de=function(t){this.be(t).de()},t.prototype.be=function(t){var e=this.Ie.get(t);return e||(e=new Et,this.Ie.set(t,e)),e},t.prototype.xe=function(t){var e=this.Ae.get(t);return e||(e=new rt(_),this.Ae=this.Ae.nt(t,e)),e},t.prototype.ve=function(t){var e=null!==this.Ce(t);return e||l("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.Ce=function(t){var e=this.Ie.get(t);return e&&e.he?null:this.Ee.Me(t)},t.prototype.Se=function(t){var e=this;this.Ie.set(t,new Et),this.Ee.$e(t).forEach((function(n){e.Ve(t,n,null)}))},t.prototype.ke=function(t,e){return this.Ee.$e(t).has(e)},t}();function Nt(){return new tt(q.P)}function At(){return new tt(q.P)}function kt(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Dt(t){var e=Ct(t.mapValue.fields.__local_write_time__.timestampValue);return new L(e.seconds,e.nanos)}var xt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function St(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?kt(t)?4:10:v()}function Pt(t,e){var n=St(t);if(n!==St(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Dt(t).isEqual(Dt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ct(t.timestampValue),r=Ct(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return qt(t.bytesValue).isEqual(qt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ut(t.geoPointValue.latitude)===Ut(e.geoPointValue.latitude)&&Ut(t.geoPointValue.longitude)===Ut(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ut(t.integerValue)===Ut(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ut(t.doubleValue),r=Ut(e.doubleValue);return n===r?F(n)===F(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return I(t.arrayValue.values||[],e.arrayValue.values||[],Pt);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(A(n)!==A(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Pt(n[i],r[i])))return!1;return!0}(t,e);default:return v()}}function Lt(t,e){return void 0!==(t.values||[]).find((function(t){return Pt(t,e)}))}function Ot(t,e){var n=St(t),r=St(e);if(n!==r)return _(n,r);switch(n){case 0:return 0;case 1:return _(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Ut(t.integerValue||t.doubleValue),r=Ut(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Rt(t.timestampValue,e.timestampValue);case 4:return Rt(Dt(t),Dt(e));case 5:return _(t.stringValue,e.stringValue);case 6:return function(t,e){var n=qt(t),r=qt(e);return n.o(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=_(n[i],r[i]);if(0!==o)return o}return _(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=_(Ut(t.latitude),Ut(e.latitude));return 0!==n?n:_(Ut(t.longitude),Ut(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ot(n[i],r[i]);if(o)return o}return _(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=_(r[s],o[s]);if(0!==u)return u;var a=Ot(n[r[s]],i[o[s]]);if(0!==a)return a}return _(r.length,o.length)}(t.mapValue,e.mapValue);default:throw v()}}function Rt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return _(t,e);var n=Ct(t),r=Ct(e),i=_(n.seconds,r.seconds);return 0!==i?i:_(n.nanos,r.nanos)}function Vt(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Ct(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?qt(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,q.B(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=t(s)}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):v();var n,r}(t)}function Ct(t){if(g(!!t),"string"==typeof t){var e=0,n=xt.exec(t);if(g(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ut(t.seconds),nanos:Ut(t.nanos)}}function Ut(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function qt(t){return"string"==typeof t?W.fromBase64String(t):W.fromUint8Array(t)}function Mt(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.N()}}function Ft(t){return!!t&&"integerValue"in t}function jt(t){return!!t&&"arrayValue"in t}function Bt(t){return!!t&&"nullValue"in t}function Gt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function zt(t){return!!t&&"mapValue"in t}var Qt={asc:"ASCENDING",desc:"DESCENDING"},Kt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Wt=function(t,e){this.s=t,this.Oe=e};function Ht(t){return{integerValue:""+t}}function Yt(t,e){if(t.Oe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:F(e)?"-0":e}}function Xt(t,e){return j(e)?Ht(e):Yt(t,e)}function $t(t,e){return t.Oe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Zt(t,e){return t.Oe?e.toBase64():e.toUint8Array()}function Jt(t,e){return $t(t,e.A())}function te(t){return g(!!t),O.I(function(t){var e=Ct(t);return new L(e.seconds,e.nanos)}(t))}function ee(t,e){return function(t){return new V(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).N()}function ne(t){var e=V.k(t);return g(_e(e)),e}function re(t,e){return ee(t.s,e.path)}function ie(t,e){var n=ne(e);return g(n.get(1)===t.s.projectId),g(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new q(ae(n))}function oe(t,e){return ee(t.s,e)}function se(t){var e=ne(t);return 4===e.length?V.$():ae(e)}function ue(t){return new V(["projects",t.s.projectId,"databases",t.s.database]).N()}function ae(t){return g(t.length>4&&"documents"===t.get(4)),t.V(5)}function ce(t,e,n){return{name:re(t,e),fields:n.proto.mapValue.fields}}function he(t,e){var n;if(e instanceof Qe)n={update:ce(t,e.key,e.value)};else if(e instanceof $e)n={delete:re(t,e.key)};else if(e instanceof Ke)n={update:ce(t,e.key,e.data),updateMask:be(e.Le)};else if(e instanceof He)n={transform:{document:re(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Ae)return{fieldPath:e.field.N(),setToServerValue:"REQUEST_TIME"};if(n instanceof ke)return{fieldPath:e.field.N(),appendMissingElements:{values:n.elements}};if(n instanceof xe)return{fieldPath:e.field.N(),removeAllFromArray:{values:n.elements}};if(n instanceof Pe)return{fieldPath:e.field.N(),increment:n.qe};throw v()}(0,t)}))}};else{if(!(e instanceof Ze))return v();n={verify:re(t,e.key)}}return e.Ue.Be||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Jt(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:v()}(t,e.Ue)),n}function fe(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Ue.updateTime(te(t.updateTime)):void 0!==t.exists?Ue.exists(t.exists):Ue.We()}(e.currentDocument):Ue.We();if(e.update){e.update.name;var r=ie(t,e.update.name),i=new Je({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new Re(e.map((function(t){return U.q(t)})))}(e.updateMask);return new Ke(r,i,o,n)}return new Qe(r,i,n)}if(e.delete){var s=ie(t,e.delete);return new $e(s,n)}if(e.transform){var u=ie(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)g("REQUEST_TIME"===e.setToServerValue),n=new Ae;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new ke(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new xe(i)}else"increment"in e?n=new Pe(t,e.increment):v();var o=U.q(e.fieldPath);return new Ve(o,n)}(t,e)}));return g(!0===n.exists),new He(u,a)}if(e.verify){var c=ie(t,e.verify);return new Ze(c,n)}return v()}function le(t,e){return{documents:[oe(t,e.path)]}}function pe(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=oe(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=oe(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Gt(t.value))return{unaryFilter:{field:ve(t.field),op:"IS_NAN"}};if(Bt(t.value))return{unaryFilter:{field:ve(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:ve(t.field),op:(e=t.op,Kt[e]),value:t.value}};var e}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:ve((e=t).field),direction:(n=e.dir,Qt[n])};var e,n}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Oe||M(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=de(e.startAt)),e.endAt&&(n.structuredQuery.endAt=de(e.endAt)),n}function de(t){return{before:t.before,values:t.position}}function ye(t){var e=!!t.before,n=t.values||[];return new Dn(n,e)}function ve(t){return{fieldPath:t.N()}}function ge(t){return U.q(t.fieldPath)}function me(t){return In.create(ge(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return v()}}(t.fieldFilter.op),t.fieldFilter.value)}function we(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ge(t.unaryFilter.field);return In.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ge(t.unaryFilter.field);return In.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return v()}}function be(t){var e=[];return t.fields.forEach((function(t){return e.push(t.N())})),{fieldPaths:e}}function _e(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Ie=function(){this.Qe=void 0};function Ee(t,e,n){return t instanceof Ae?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ke?De(t,e):t instanceof xe?Se(t,e):function(t,e){var n=Ne(t,e),r=Le(n)+Le(t.qe);return Ft(n)&&Ft(t.qe)?Ht(r):Yt(t.serializer,r)}(t,e)}function Te(t,e,n){return t instanceof ke?De(t,e):t instanceof xe?Se(t,e):n}function Ne(t,e){return t instanceof Pe?Ft(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Ae=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e}(Ie),ke=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return i.__extends(e,t),e}(Ie);function De(t,e){for(var n=Oe(e),r=function(t){n.some((function(e){return Pt(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var xe=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return i.__extends(e,t),e}(Ie);function Se(t,e){for(var n=Oe(e),r=function(t){n=n.filter((function(e){return!Pt(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Pe=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.qe=n,r}return i.__extends(e,t),e}(Ie);function Le(t){return Ut(t.integerValue||t.doubleValue)}function Oe(t){return jt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Re=function(){function t(t){this.fields=t,t.sort(U.P)}return t.prototype.je=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},t.prototype.isEqual=function(t){return I(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Ve=function(t,e){this.field=t,this.transform=e},Ce=function(t,e){this.version=t,this.transformResults=e},Ue=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.We=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"Be",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function qe(t,e){return void 0!==t.updateTime?e instanceof rn&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof rn}var Me=function(){};function Fe(t,e,n){return t instanceof Qe?function(t,e,n){return new rn(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Ke?function(t,e,n){if(!qe(t.Ue,e))return new sn(t.key,n.version);var r=We(t,e);return new rn(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof He?function(t,e,n){if(g(null!=n.transformResults),!qe(t.Ue,e))return new sn(t.key,n.version);var r=Ye(t,e),i=function(t,e,n){var r=[];g(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof rn&&(u=e.field(o.field)),r.push(Te(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Xe(t,r.data(),i);return new rn(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new on(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function je(t,e,n,r){return t instanceof Qe?function(t,e){if(!qe(t.Ue,e))return e;var n=ze(e);return new rn(t.key,n,t.value,{Ke:!0})}(t,e):t instanceof Ke?function(t,e){if(!qe(t.Ue,e))return e;var n=ze(e),r=We(t,e);return new rn(t.key,n,r,{Ke:!0})}(t,e):t instanceof He?function(t,e,n,r){if(!qe(t.Ue,e))return e;var i=Ye(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof rn&&(c=n.field(u.field)),null===c&&r instanceof rn&&(c=r.field(u.field)),i.push(Ee(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=Xe(t,i.data(),o);return new rn(t.key,i.version,s,{Ke:!0})}(t,e,r,n):function(t,e){return qe(t.Ue,e)?new on(t.key,O.min()):e}(t,e)}function Be(t,e){return t instanceof He?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof rn?e.field(o.field):void 0,u=Ne(o.transform,s||null);null!=u&&(n=null==n?(new tn).set(o.field,u):n.set(o.field,u))}return n?n.Ge():null}(t,e):null}function Ge(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ue.isEqual(e.Ue)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Le.isEqual(e.Le):2!==t.type||I(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ke&&e instanceof ke||t instanceof xe&&e instanceof xe?I(t.elements,e.elements,Pt):t instanceof Pe&&e instanceof Pe?Pt(t.qe,e.qe):t instanceof Ae&&e instanceof Ae}(t.transform,e.transform)}(t,e)})))}function ze(t){return t instanceof rn?t.version:O.min()}var Qe=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ue=r,i.type=0,i}return i.__extends(e,t),e}(Me),Ke=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Le=r,o.Ue=i,o.type=1,o}return i.__extends(e,t),e}(Me);function We(t,e){return function(t,e){var n=new tn(e);return t.Le.fields.forEach((function(e){if(!e._()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.Ge()}(t,e instanceof rn?e.data():Je.empty())}var He=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ue=Ue.exists(!0),r}return i.__extends(e,t),e}(Me);function Ye(t,e){return e}function Xe(t,e,n){for(var r=new tn(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Ge()}var $e=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ue=n,r.type=3,r}return i.__extends(e,t),e}(Me),Ze=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ue=n,r.type=4,r}return i.__extends(e,t),e}(Me),Je=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!zt(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},t.prototype.isEqual=function(t){return Pt(this.proto,t.proto)},t}(),tn=function(){function t(t){void 0===t&&(t=Je.empty()),this.ze=t,this.He=new Map}return t.prototype.set=function(t,e){return this.Ye(t,e),this},t.prototype.delete=function(t){return this.Ye(t,null),this},t.prototype.Ye=function(t,e){for(var n=this.He,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===St(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.S(),e)},t.prototype.Ge=function(){var t=this.Je(U.$(),this.He);return null!=t?new Je(t):this.ze},t.prototype.Je=function(t,e){var n=this,r=!1,i=this.ze.field(t),o=zt(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.Je(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function en(t){var e=[];return k(t.fields||{},(function(t,n){var r=new U([t]);if(zt(n)){var i=en(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new Re(e)}var nn=function(t,e){this.key=t,this.version=e},rn=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).Xe=r,o.Ke=!!i.Ke,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return i.__extends(e,t),e.prototype.field=function(t){return this.Xe.field(t)},e.prototype.data=function(){return this.Xe},e.prototype.Ze=function(){return this.Xe.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ke===t.Ke&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Xe.isEqual(t.Xe)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Xe.toString()+", {hasLocalMutations: "+this.Ke+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.Ke||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(nn),on=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return i.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(nn),sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(nn);function un(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new P(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass '"+e.name+"' from a different Firestore SDK?"):new P(S.INVALID_ARGUMENT,"Expected type '"+e.name+"', but was '"+t.constructor.name+"'");return t}var an=function(){function t(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.tn=n,this.filters=r,this.limit=i,this.en=o,this.startAt=s,this.endAt=u,this.nn=null,this.sn=null,this.startAt,this.endAt}return t.prototype.rn=function(e){return new t(e,null,this.tn.slice(),this.filters.slice(),this.limit,this.en,this.startAt,this.endAt)},t.prototype.on=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.tn.length||1===this.tn.length&&this.tn[0].field.O())},t.prototype.hn=function(){return!M(this.limit)&&"F"===this.en},t.prototype.an=function(){return!M(this.limit)&&"L"===this.en},t.prototype.un=function(){return this.tn.length>0?this.tn[0].field:null},t.prototype.cn=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n.ln())return n.field}return null},t.prototype._n=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(t.indexOf(r.op)>=0)return r.op}return null},t}();function cn(t,e,n,r,i,o,s,u){return new an(t,e,n,r,i,o,s,u)}function hn(t){return new an(t)}function fn(t){return null!==t.collectionGroup}function ln(t){var e=un(t,an);if(null===e.nn){e.nn=[];var n=e.cn(),r=e.un();if(null!==n&&null===r)n.O()||e.nn.push(new Ln(n)),e.nn.push(new Ln(U.L(),"asc"));else{for(var i=!1,o=0,s=e.tn;o<s.length;o++){var u=s[o];e.nn.push(u),u.field.O()&&(i=!0)}if(!i){var a=e.tn.length>0?e.tn[e.tn.length-1].dir:"asc";e.nn.push(new Ln(U.L(),a))}}}return e.nn}function pn(t){var e=un(t,an);if(!e.sn)if("F"===e.en)e.sn=G(e.path,e.collectionGroup,ln(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ln(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Ln(o.field,s))}var u=e.endAt?new Dn(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Dn(e.startAt.position,!e.startAt.before):null;e.sn=G(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.sn}function dn(t,e,n){return new an(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function yn(t,e){return new an(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),t.limit,t.en,e,t.endAt)}function vn(t,e){return new an(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),t.limit,t.en,t.startAt,e)}function gn(t,e){return Q(pn(t),pn(e))&&t.en===e.en}function mn(t){return z(pn(t))+"|lt:"+t.en}function wn(t){return"Query(target="+function(t){var e=t.path.N();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.N()+" "+e.op+" "+Vt(e.value);var e})).join(", ")+"]"),M(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return(e=t).field.N()+" ("+e.dir+")";var e})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+xn(t.startAt)),t.endAt&&(e+=", endAt: "+xn(t.endAt)),"Target("+e+")"}(pn(t))+"; limitType="+t.en+")"}function bn(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.U(t.collectionGroup)&&t.path.D(n):q.W(t.path)?t.path.isEqual(n):t.path.C(n)}(t,e)&&function(t,e){for(var n=0,r=t.tn;n<r.length;n++){var i=r[n];if(!i.field.O()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Sn(t.startAt,ln(t),e)||t.endAt&&Sn(t.endAt,ln(t),e))}(t,e)}function _n(t){return function(e,n){for(var r=!1,i=0,o=ln(t);i<o.length;i++){var s=o[i],u=On(s,e,n);if(0!==u)return u;r=r||s.field.O()}return 0}}var In=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return i.__extends(e,t),e.create=function(t,n,r){if(t.O())return"in"===n?new Tn(t,r):new En(t,n,r);if(Bt(r)){if("=="!==n)throw new P(S.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(Gt(r)){if("=="!==n)throw new P(S.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return"array-contains"===n?new Nn(t,r):"in"===n?new An(t,r):"array-contains-any"===n?new kn(t,r):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&St(this.value)===St(e)&&this.fn(Ot(e,this.value))},e.prototype.fn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return t>0;case">=":return t>=0;default:return v()}},e.prototype.ln=function(){return["<","<=",">",">="].indexOf(this.op)>=0},e}((function(){})),En=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=q.B(r.referenceValue),i}return i.__extends(e,t),e.prototype.matches=function(t){var e=q.P(t.key,this.key);return this.fn(e)},e}(In),Tn=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=(n.arrayValue.values||[]).map((function(t){return q.B(t.referenceValue)})),r}return i.__extends(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(In),Nn=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return i.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return jt(e)&&Lt(e.arrayValue,this.value)},e}(In),An=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return i.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Lt(this.value.arrayValue,e)},e}(In),kn=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return i.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!jt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Lt(e.value.arrayValue,t)}))},e}(In),Dn=function(t,e){this.position=t,this.before=e};function xn(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Vt(t)})).join(",")}function Sn(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.O()?q.P(q.B(s.referenceValue),n.key):Ot(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Pn(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Pt(t.position[n],e.position[n]))return!1;return!0}var Ln=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function On(t,e,n){var r=t.field.O()?q.P(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Ot(r,i):v()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return v()}}function Rn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var Vn=function(){function t(t,e,n,r){this.batchId=t,this.dn=e,this.baseMutations=n,this.mutations=r}return t.prototype.wn=function(t,e,n){for(var r=n.Tn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Fe(o,e,r[i]))}return e},t.prototype.En=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=je(i,e,e,this.dn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=je(a,e,o,this.dn))}return e},t.prototype.In=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.En(r.key,t.get(r.key));i&&(n=n.nt(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),lt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&I(this.mutations,t.mutations,(function(t,e){return Ge(t,e)}))&&I(this.baseMutations,t.baseMutations,(function(t,e){return Ge(t,e)}))},t}(),Cn=function(){function t(t,e,n,r){this.batch=t,this.mn=e,this.Tn=n,this.An=r}return t.from=function(e,n,r){g(e.mutations.length===r.length);for(var i=ht,o=e.mutations,s=0;s<o.length;s++)i=i.nt(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Un=function(){function t(t){var e=this;this.Rn=null,this.Pn=null,this.result=void 0,this.error=void 0,this.gn=!1,this.Vn=!1,t((function(t){e.gn=!0,e.result=t,e.Rn&&e.Rn(t)}),(function(t){e.gn=!0,e.error=t,e.Pn&&e.Pn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Vn&&v(),this.Vn=!0,this.gn?this.error?this.yn(n,this.error):this.pn(e,this.result):new t((function(t,i){r.Rn=function(n){r.pn(e,n).next(t,i)},r.Pn=function(e){r.yn(n,e).next(t,i)}}))},t.prototype.bn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.vn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.pn=function(e,n){return e?this.vn((function(){return e(n)})):t.resolve(n)},t.prototype.yn=function(e,n){return e?this.vn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.Sn=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.Dn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.Sn(r)},t}(),qn=function(){function t(){this.Cn=new x((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.Fn=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.Nn},set:function(t){this.Nn=t},enumerable:!1,configurable:!0}),t.prototype.kn=function(t,e){this.xn(),this.readTime=e,this.Cn.set(t.key,t)},t.prototype.$n=function(t,e){this.xn(),e&&(this.readTime=e),this.Cn.set(t,null)},t.prototype.Mn=function(t,e){this.xn();var n=this.Cn.get(e);return void 0!==n?Un.resolve(n):this.On(t,e)},t.prototype.getEntries=function(t,e){return this.Ln(t,e)},t.prototype.apply=function(t){return this.xn(),this.Fn=!0,this.qn(t)},t.prototype.xn=function(){},t}(),Mn="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Fn=function(){function t(){this.Bn=[]}return t.prototype.Un=function(t){this.Bn.push(t)},t.prototype.Wn=function(){this.Bn.forEach((function(t){return t()}))},t}(),jn=function(){function t(t,e,n){this.Qn=t,this.jn=e,this.Kn=n}return t.prototype.Gn=function(t,e){var n=this;return this.jn.zn(t,e).next((function(r){return n.Hn(t,e,r)}))},t.prototype.Hn=function(t,e,n){return this.Qn.Mn(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].En(e,t);return t}))},t.prototype.Yn=function(t,e,n){var r=ut();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].En(t,e);r=r.nt(t,e)})),r},t.prototype.Jn=function(t,e){var n=this;return this.Qn.getEntries(t,e).next((function(e){return n.Xn(t,e)}))},t.prototype.Xn=function(t,e){var n=this;return this.jn.Zn(t,e).next((function(r){var i=n.Yn(t,e,r),o=st();return i.forEach((function(t,e){e||(e=new on(t,O.min())),o=o.nt(t,e)})),o}))},t.prototype.ts=function(t,e,n){return function(t){return q.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.es(t,e.path):fn(e)?this.ns(t,e,n):this.ss(t,e,n)},t.prototype.es=function(t,e){return this.Gn(t,new q(e)).next((function(t){var e=ct();return t instanceof rn&&(e=e.nt(t.key,t)),e}))},t.prototype.ns=function(t,e,n){var r=this,i=e.collectionGroup,o=ct();return this.Kn.rs(t,i).next((function(s){return Un.forEach(s,(function(s){var u=e.rn(s.child(i));return r.ss(t,u,n).next((function(t){t.forEach((function(t,e){o=o.nt(t,e)}))}))})).next((function(){return o}))}))},t.prototype.ss=function(t,e,n){var r,i,o=this;return this.Qn.ts(t,e,n).next((function(n){return r=n,o.jn.os(t,e)})).next((function(e){return i=e,o.hs(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=je(a,h,h,o.dn);r=f instanceof rn?r.nt(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){bn(e,n)||(r=r.remove(t))})),r}))},t.prototype.hs=function(t,e,n){for(var r=lt(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Ke&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Qn.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof rn&&(c=c.nt(t,e))})),c}))},t}(),Bn=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.as=n,this.us=r}return t.cs=function(e,n){for(var r=lt(),i=lt(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Gn=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.ls=function(t){return n._s(t)},this.fs=function(t){return e.ds(t)})}return t.prototype._s=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.fs&&this.fs(t),t},t}();Gn.ws=-1;var zn=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Qn=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Ts=t,this.Es=e,this.Is=n,this.ms=r,this.As=i,this.Rs=0,this.Ps=null,this.gs=Date.now(),this.reset()}return t.prototype.reset=function(){this.Rs=0},t.prototype.Vs=function(){this.Rs=this.As},t.prototype.ys=function(t){var e=this;this.cancel();var n=Math.floor(this.Rs+this.ps()),r=Math.max(0,Date.now()-this.gs),i=Math.max(0,n-r);i>0&&l("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Rs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ps=this.Ts.bs(this.Es,i,(function(){return e.gs=Date.now(),t()})),this.Rs*=this.ms,this.Rs<this.Is&&(this.Rs=this.Is),this.Rs>this.As&&(this.Rs=this.As)},t.prototype.vs=function(){null!==this.Ps&&(this.Ps.Ss(),this.Ps=null)},t.prototype.cancel=function(){null!==this.Ps&&(this.Ps.cancel(),this.Ps=null)},t.prototype.ps=function(){return(Math.random()-.5)*this.Rs},t}();function Kn(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Hn(e)),e=Wn(t.get(n),e);return Hn(e)}function Wn(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Hn(t){return t+""}function Yn(t){var e=t.length;if(g(e>=2),2===e)return g(""===t.charAt(0)&&""===t.charAt(1)),V.$();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&v(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:v()}o=s+2}return new V(r)}var Xn=function(){function t(){this.Ds=new $n}return t.prototype.Cs=function(t,e){return this.Ds.add(e),Un.resolve()},t.prototype.rs=function(t,e){return Un.resolve(this.Ds.getEntries(e))},t}(),$n=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new rt(V.P),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new rt(V.P)).F()},t}(),Zn=function(){function t(){this.Fs=new $n}return t.prototype.Cs=function(t,e){var n=this;if(!this.Fs.has(e)){var r=e.S(),i=e.p();t.Un((function(){n.Fs.add(e)}));var o={collectionId:r,parent:Kn(i)};return Jn(t).put(o)}return Un.resolve()},t.prototype.rs=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[E(e),""],!1,!0);return Jn(t).Ns(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Yn(o.parent))}return n}))},t}();function Jn(t){return Ir.ks(t,Hr.store)}var tr=function(t){this.xs=t};function er(t,e){if(e.document)return function(t,e,n){var r=ie(t,e.name),i=te(e.updateTime),o=new Je({mapValue:{fields:e.fields}});return new rn(r,i,o,{hasCommittedMutations:!!n})}(t.xs,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=q.j(e.noDocument.path),r=sr(e.noDocument.readTime);return new on(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=q.j(e.unknownDocument.path),o=sr(e.unknownDocument.version);return new sn(i,o)}return v()}function nr(t,e,n){var r=rr(n),i=e.key.path.p().F();if(e instanceof rn){var o=function(t,e){return{name:re(t,e.key),fields:e.Ze().mapValue.fields,updateTime:$t(t,e.version.A())}}(t.xs,e),s=e.hasCommittedMutations;return new Gr(null,null,o,s,r,i)}if(e instanceof on){var u=e.key.path.F(),a=or(e.version),c=e.hasCommittedMutations;return new Gr(null,new jr(u,a),null,c,r,i)}if(e instanceof sn){var h=e.key.path.F(),f=or(e.version);return new Gr(new Br(h,f),null,null,!0,r,i)}return v()}function rr(t){var e=t.A();return[e.seconds,e.nanoseconds]}function ir(t){var e=new L(t[0],t[1]);return O.I(e)}function or(t){var e=t.A();return new Cr(e.seconds,e.nanoseconds)}function sr(t){var e=new L(t.seconds,t.nanoseconds);return O.I(e)}function ur(t,e){var n=(e.baseMutations||[]).map((function(e){return fe(t.xs,e)})),r=e.mutations.map((function(e){return fe(t.xs,e)})),i=L.fromMillis(e.localWriteTimeMs);return new Vn(e.batchId,i,n,r)}function ar(t){var e,n,r=sr(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?sr(t.lastLimboFreeSnapshotVersion):O.min();return void 0!==t.query.documents?(g(1===(n=t.query).documents.length),e=pn(hn(se(n.documents[0])))):e=function(t){var e=se(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){g(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[we(e)]:void 0!==e.fieldFilter?[me(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):v():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return new Ln(ge((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var a=null;n.limit&&(a=function(t){var e;return M(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ye(n.startAt));var h=null;return n.endAt&&(h=ye(n.endAt)),pn(cn(e,i,u,s,a,"F",c,h))}(t.query),new X(e,t.targetId,0,t.lastListenSequenceNumber,r,i,W.fromBase64String(t.resumeToken))}function cr(t,e){var n,r=or(e.X),i=or(e.lastLimboFreeSnapshotVersion);n=K(e.target)?le(t.xs,e.target):pe(t.xs,e.target);var o=e.resumeToken.toBase64();return new Qr(e.targetId,z(e.target),r,o,e.sequenceNumber,i,n)}var hr=function(){function t(t,e){this.serializer=t,this.Kn=e}return t.prototype.kn=function(t,e,n){return lr(t).put(pr(e),n)},t.prototype.$n=function(t,e){var n=lr(t),r=pr(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.$s(t,r)}))},t.prototype.Mn=function(t,e){var n=this;return lr(t).get(pr(e)).next((function(t){return n.Ms(t)}))},t.prototype.Os=function(t,e){var n=this;return lr(t).get(pr(e)).next((function(t){var e=n.Ms(t);return e?{Ls:e,size:dr(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=ut();return this.qs(t,e,(function(t,e){var i=n.Ms(e);r=r.nt(t,i)})).next((function(){return r}))},t.prototype.Bs=function(t,e){var n=this,r=ut(),i=new tt(q.P);return this.qs(t,e,(function(t,e){var o=n.Ms(e);o?(r=r.nt(t,o),i=i.nt(t,dr(e))):(r=r.nt(t,null),i=i.nt(t,0))})).next((function(){return{Us:r,Ws:i}}))},t.prototype.qs=function(t,e,n){if(e._())return Un.resolve();var r=IDBKeyRange.bound(e.first().path.F(),e.last().path.F()),i=e.at(),o=i.dt();return lr(t).Qs({range:r},(function(t,e,r){for(var s=q.j(t);o&&q.P(o,s)<0;)n(o,null),o=i.dt();o&&o.isEqual(s)&&(n(o,e),o=i.wt()?i.dt():null),o?r.js(o.path.F()):r.done()})).next((function(){for(;o;)n(o,null),o=i.wt()?i.dt():null}))},t.prototype.ts=function(t,e,n){var r=this,i=ct(),o=e.path.length+1,s={};if(n.isEqual(O.min())){var u=e.path.F();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.F(),c=rr(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Gr.collectionReadTimeIndex}return lr(t).Qs(s,(function(t,n,s){if(t.length===o){var u=er(r.serializer,n);e.path.D(u.key.path)?u instanceof rn&&bn(e,u)&&(i=i.nt(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.Ks=function(t,e){var n=this,r=st(),i=rr(e),o=lr(t),s=IDBKeyRange.lowerBound(i,!0);return o.Qs({index:Gr.readTimeIndex,range:s},(function(t,e){var o=er(n.serializer,e);r=r.nt(o.key,o),i=e.readTime})).next((function(){return{Gs:r,readTime:ir(i)}}))},t.prototype.zs=function(t){var e=lr(t),n=O.min();return e.Qs({index:Gr.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=ir(e.readTime)),r.done()})).next((function(){return n}))},t.prototype.Hs=function(e){return new t.Ys(this,!!e&&e.Js)},t.prototype.Xs=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return fr(t).get(zr.key).next((function(t){return g(!!t),t}))},t.prototype.$s=function(t,e){return fr(t).put(zr.key,e)},t.prototype.Ms=function(t){if(t){var e=er(this.serializer,t);return e instanceof on&&e.version.isEqual(O.min())?null:e}return null},t}();function fr(t){return Ir.ks(t,zr.store)}function lr(t){return Ir.ks(t,Gr.store)}function pr(t){return t.path.F()}function dr(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw v();e=t.noDocument}return JSON.stringify(e).length}hr.Ys=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Zs=e,r.Js=n,r.ti=new x((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return i.__extends(e,t),e.prototype.qn=function(t){var e=this,n=[],r=0,i=new rt((function(t,e){return _(t.N(),e.N())}));return this.Cn.forEach((function(o,s){var u=e.ti.get(o);if(s){var a=nr(e.Zs.serializer,s,e.readTime);i=i.add(o.path.p());var c=dr(a);r+=c-u,n.push(e.Zs.kn(t,o,a))}else if(r-=u,e.Js){var h=nr(e.Zs.serializer,new on(o,O.min()),e.readTime);n.push(e.Zs.kn(t,o,h))}else n.push(e.Zs.$n(t,o))})),i.forEach((function(r){n.push(e.Zs.Kn.Cs(t,r))})),n.push(this.Zs.updateMetadata(t,r)),Un.Sn(n)},e.prototype.On=function(t,e){var n=this;return this.Zs.Os(t,e).next((function(t){return null===t?(n.ti.set(e,0),null):(n.ti.set(e,t.size),t.Ls)}))},e.prototype.Ln=function(t,e){var n=this;return this.Zs.Bs(t,e).next((function(t){var e=t.Us;return t.Ws.forEach((function(t,e){n.ti.set(t,e)})),e}))},e}(qn);var yr=function(){function t(t){this.ei=t}return t.prototype.next=function(){return this.ei+=2,this.ei},t.ni=function(){return new t(0)},t.si=function(){return new t(-1)},t}(),vr=function(){function t(t,e){this.ii=t,this.serializer=e}return t.prototype.ri=function(t){var e=this;return this.oi(t).next((function(n){var r=new yr(n.highestTargetId);return n.highestTargetId=r.next(),e.hi(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.ai=function(t){return this.oi(t).next((function(t){return O.I(new L(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.ui=function(t){return this.oi(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.ci=function(t,e,n){var r=this;return this.oi(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.A()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.hi(t,i)}))},t.prototype.li=function(t,e){var n=this;return this._i(t,e).next((function(){return n.oi(t).next((function(r){return r.targetCount+=1,n.fi(e,r),n.hi(t,r)}))}))},t.prototype.di=function(t,e){return this._i(t,e)},t.prototype.wi=function(t,e){var n=this;return this.Ti(t,e.targetId).next((function(){return gr(t).delete(e.targetId)})).next((function(){return n.oi(t)})).next((function(e){return g(e.targetCount>0),e.targetCount-=1,n.hi(t,e)}))},t.prototype.Ei=function(t,e,n){var r=this,i=0,o=[];return gr(t).Qs((function(s,u){var a=ar(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.wi(t,a)))})).next((function(){return Un.Sn(o)})).next((function(){return i}))},t.prototype.pe=function(t,e){return gr(t).Qs((function(t,n){var r=ar(n);e(r)}))},t.prototype.oi=function(t){return mr(t).get(Wr.key).next((function(t){return g(null!==t),t}))},t.prototype.hi=function(t,e){return mr(t).put(Wr.key,e)},t.prototype._i=function(t,e){return gr(t).put(cr(this.serializer,e))},t.prototype.fi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.Ii=function(t){return this.oi(t).next((function(t){return t.targetCount}))},t.prototype.mi=function(t,e){var n=z(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return gr(t).Qs({range:r,index:Qr.queryTargetsIndexName},(function(t,n,r){var o=ar(n);Q(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.Ai=function(t,e,n){var r=this,i=[],o=wr(t);return e.forEach((function(e){var s=Kn(e.path);i.push(o.put(new Kr(n,s))),i.push(r.ii.Ri(t,n,e))})),Un.Sn(i)},t.prototype.Pi=function(t,e,n){var r=this,i=wr(t);return Un.forEach(e,(function(e){var o=Kn(e.path);return Un.Sn([i.delete([n,o]),r.ii.gi(t,n,e)])}))},t.prototype.Ti=function(t,e){var n=wr(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.Vi=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=wr(t),i=lt();return r.Qs({range:n,yi:!0},(function(t,e,n){var r=Yn(t[1]),o=new q(r);i=i.add(o)})).next((function(){return i}))},t.prototype.pi=function(t,e){var n=Kn(e.path),r=IDBKeyRange.bound([n],[E(n)],!1,!0),i=0;return wr(t).Qs({index:Kr.documentTargetsIndex,yi:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Me=function(t,e){return gr(t).get(e).next((function(t){return t?ar(t):null}))},t}();function gr(t){return Ir.ks(t,Qr.store)}function mr(t){return Ir.ks(t,Wr.store)}function wr(t){return Ir.ks(t,Kr.store)}var br="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",_r=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).bi=e,r.vi=n,r}return i.__extends(e,t),e}(Fn),Ir=function(){function t(e,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Ts=o,this.window=s,this.document=u,this.Si=c,this.Di=h,this.Ci=null,this.Fi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.ki=null,this.xi=null,this.$i=Number.NEGATIVE_INFINITY,this.Mi=function(t){return Promise.resolve()},!t.Oi())throw new P(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.ii=new Nr(this,i),this.Li=n+"main",this.serializer=new tr(a),this.qi=new vr(this.ii,this.serializer),this.Kn=new Zn,this.Qn=new hr(this.serializer,this.Kn),this.window&&this.window.localStorage?this.Bi=this.window.localStorage:(this.Bi=null,!1===h&&p("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.ks=function(t,e){if(t instanceof _r)return Zr.ks(t.bi,e);throw v()},t.prototype.start=function(){var t=this;return Zr.Ui(this.Li,Rr,new Vr(this.serializer)).then((function(e){return t.Wi=e,t.Qi()})).then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new P(S.FAILED_PRECONDITION,br);return t.ji(),t.Ki(),t.Gi(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qi.ui(e)}))})).then((function(e){t.Ci=new Gn(e,t.Si)})).then((function(){t.Fi=!0})).catch((function(e){return t.Wi&&t.Wi.close(),Promise.reject(e)}))},t.prototype.zi=function(t){var e=this;return this.Mi=function(n){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(e){return this.Hi?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.Yi=function(t){var e=this;this.Wi.Ji((function(n){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.Xi=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Ts.Zi((function(){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.Hi?[4,this.Qi()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.Qi=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Tr(e).put(new Xr(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.tr(e).next((function(e){e||(t.isPrimary=!1,t.Ts.er((function(){return t.Mi(!1)})))}))})).next((function(){return t.nr(e)})).next((function(n){return t.isPrimary&&!n?t.sr(e).next((function(){return!1})):!!n&&t.ir(e).next((function(){return!0}))}))})).catch((function(e){if(ei(e))return l("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return l("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Ts.er((function(){return t.Mi(e)})),t.isPrimary=e}))},t.prototype.tr=function(t){var e=this;return Er(t).get(Ur.key).next((function(t){return Un.resolve(e.rr(t))}))},t.prototype.or=function(t){return Tr(t).delete(this.clientId)},t.prototype.hr=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.ar(this.$i,18e5)?[3,2]:(this.$i=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.ks(e,Xr.store);return n.Ns().next((function(t){var e=s.ur(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return Un.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(e=i.sent(),this.Bi)for(n=0,r=e;n<r.length;n++)o=r[n],this.Bi.removeItem(this.cr(o.clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.Gi=function(){var t=this;this.xi=this.Ts.bs("client_metadata_refresh",4e3,(function(){return t.Qi().then((function(){return t.hr()})).then((function(){return t.Gi()}))}))},t.prototype.rr=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.nr=function(t){var e=this;return this.Di?Un.resolve(!0):Er(t).get(Ur.key).next((function(n){if(null!==n&&e.ar(n.leaseTimestampMs,5e3)&&!e.lr(n.ownerId)){if(e.rr(n)&&e.networkEnabled)return!0;if(!e.rr(n)){if(!n.allowTabSynchronization)throw new P(S.FAILED_PRECONDITION,br);return!1}}return!(!e.networkEnabled||!e.inForeground)||Tr(t).Ns().next((function(t){return void 0===e.ur(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&l("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype._r=function(){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(e){switch(e.label){case 0:return this.Fi=!1,this.dr(),this.xi&&(this.xi.cancel(),this.xi=null),this.wr(),this.Tr(),[4,this.runTransaction("shutdown","readwrite",(function(e){return t.sr(e).next((function(){return t.or(e)}))})).catch((function(t){l("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)}))];case 1:return e.sent(),this.Wi.close(),this.Er(),[2]}}))}))},t.prototype.ur=function(t,e){var n=this;return t.filter((function(t){return n.ar(t.updateTimeMs,e)&&!n.lr(t.clientId)}))},t.prototype.Ir=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Tr(e).Ns().next((function(e){return t.ur(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"Hi",{get:function(){return this.Fi},enumerable:!1,configurable:!0}),t.prototype.mr=function(t){return Dr.Ar(t,this.serializer,this.Kn,this.ii)},t.prototype.Rr=function(){return this.qi},t.prototype.Pr=function(){return this.Qn},t.prototype.gr=function(){return this.Kn},t.prototype.runTransaction=function(t,e,n){var r=this;l("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Wi.runTransaction(o,$r,(function(o){return i=new _r(o,r.Ci?r.Ci.next():Gn.ws),"readwrite-primary"===e?r.tr(i).next((function(t){return!!t||r.nr(i)})).next((function(e){if(!e)throw p("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Ts.er((function(){return r.Mi(!1)})),new P(S.FAILED_PRECONDITION,Mn);return n(i)})).next((function(t){return r.ir(i).next((function(){return t}))})):r.Vr(i).next((function(){return n(i)}))})).then((function(t){return i.Wn(),t}))},t.prototype.Vr=function(t){var e=this;return Er(t).get(Ur.key).next((function(t){if(null!==t&&e.ar(t.leaseTimestampMs,5e3)&&!e.lr(t.ownerId)&&!e.rr(t)&&!(e.Di||e.allowTabSynchronization&&t.allowTabSynchronization))throw new P(S.FAILED_PRECONDITION,br)}))},t.prototype.ir=function(t){var e=new Ur(this.clientId,this.allowTabSynchronization,Date.now());return Er(t).put(Ur.key,e)},t.Oi=function(){return Zr.Oi()},t.prototype.sr=function(t){var e=this,n=Er(t);return n.get(Ur.key).next((function(t){return e.rr(t)?(l("IndexedDbPersistence","Releasing primary lease."),n.delete(Ur.key)):Un.resolve()}))},t.prototype.ar=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(p("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.ji=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ki=function(){t.Ts.Zi((function(){return t.inForeground="visible"===t.document.visibilityState,t.Qi()}))},this.document.addEventListener("visibilitychange",this.ki),this.inForeground="visible"===this.document.visibilityState)},t.prototype.wr=function(){this.ki&&(this.document.removeEventListener("visibilitychange",this.ki),this.ki=null)},t.prototype.Ki=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ni=function(){e.dr(),e.Ts.Zi((function(){return e._r()}))},this.window.addEventListener("unload",this.Ni))},t.prototype.Tr=function(){this.Ni&&(this.window.removeEventListener("unload",this.Ni),this.Ni=null)},t.prototype.lr=function(t){var e;try{var n=null!==(null===(e=this.Bi)||void 0===e?void 0:e.getItem(this.cr(t)));return l("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return p("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.dr=function(){if(this.Bi)try{this.Bi.setItem(this.cr(this.clientId),String(Date.now()))}catch(t){p("Failed to set zombie client id.",t)}},t.prototype.Er=function(){if(this.Bi)try{this.Bi.removeItem(this.cr(this.clientId))}catch(t){}},t.prototype.cr=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Er(t){return Ir.ks(t,Ur.store)}function Tr(t){return Ir.ks(t,Xr.store)}var Nr=function(){function t(t,e){this.db=t,this.yr=new vi(this,e)}return t.prototype.pr=function(t){var e=this.br(t);return this.db.Rr().Ii(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.br=function(t){var e=0;return this.vr(t,(function(t){e++})).next((function(){return e}))},t.prototype.pe=function(t,e){return this.db.Rr().pe(t,e)},t.prototype.vr=function(t,e){return this.Sr(t,(function(t,n){return e(n)}))},t.prototype.Ri=function(t,e,n){return Ar(t,n)},t.prototype.gi=function(t,e,n){return Ar(t,n)},t.prototype.Ei=function(t,e,n){return this.db.Rr().Ei(t,e,n)},t.prototype.Dr=function(t,e){return Ar(t,e)},t.prototype.Cr=function(t,e){return function(t,e){var n=!1;return Or(t).Fr((function(r){return xr(t,r,e).next((function(t){return t&&(n=!0),Un.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.Nr=function(t,e){var n=this,r=this.db.Pr().Hs(),i=[],o=0;return this.Sr(t,(function(s,u){if(u<=e){var a=n.Cr(t,s).next((function(e){if(!e)return o++,r.Mn(t,s).next((function(){return r.$n(s),wr(t).delete([0,Kn(s.path)])}))}));i.push(a)}})).next((function(){return Un.Sn(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.Z(t.vi);return this.db.Rr().di(t,n)},t.prototype.kr=function(t,e){return Ar(t,e)},t.prototype.Sr=function(t,e){var n,r=wr(t),i=Gn.ws;return r.Qs({index:Kr.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==Gn.ws&&e(new q(Yn(n)),i),i=u,n=s):i=Gn.ws})).next((function(){i!==Gn.ws&&e(new q(Yn(n)),i)}))},t.prototype.xr=function(t){return this.db.Pr().Xs(t)},t}();function Ar(t,e){return wr(t).put(function(t,e){return new Kr(0,Kn(t.path),e)}(e,t.vi))}function kr(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Dr=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.Kn=n,this.ii=r,this.$r={}}return t.Ar=function(e,n,r,i){return g(""!==e.uid),new t(e.Mr()?e.uid:"",n,r,i)},t.prototype.Or=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Pr(t).Qs({index:Mr.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Lr=function(t,e,n,r){var i=this,o=Lr(t),s=Pr(t);return s.add({}).next((function(u){g("number"==typeof u);for(var a=new Vn(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return he(t.xs,e)})),i=n.mutations.map((function(e){return he(t.xs,e)}));return new Mr(e,n.batchId,n.dn.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new rt((function(t,e){return _(t.N(),e.N())})),l=0,p=r;l<p.length;l++){var d=p[l],y=Fr.key(i.userId,d.key.path,u);f=f.add(d.key.path.p()),h.push(s.put(c)),h.push(o.put(y,Fr.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Kn.Cs(t,e))})),t.Un((function(){i.$r[u]=a.keys()})),Un.Sn(h).next((function(){return a}))}))},t.prototype.qr=function(t,e){var n=this;return Pr(t).get(e).next((function(t){return t?(g(t.userId===n.userId),ur(n.serializer,t)):null}))},t.prototype.Br=function(t,e){var n=this;return this.$r[e]?Un.resolve(this.$r[e]):this.qr(t,e).next((function(t){if(t){var r=t.keys();return n.$r[e]=r,r}return null}))},t.prototype.Ur=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Pr(t).Qs({index:Mr.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(g(e.batchId>=r),o=ur(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.Wr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Pr(t).Qs({index:Mr.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.Qr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Pr(t).Ns(Mr.userMutationsIndex,n).next((function(t){return t.map((function(t){return ur(e.serializer,t)}))}))},t.prototype.zn=function(t,e){var n=this,r=Fr.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Lr(t).Qs({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=Yn(a);if(u===n.userId&&e.path.isEqual(h))return Pr(t).get(c).next((function(t){if(!t)throw v();g(t.userId===n.userId),o.push(ur(n.serializer,t))}));s.done()})).next((function(){return o}))},t.prototype.Zn=function(t,e){var n=this,r=new rt(_),i=[];return e.forEach((function(e){var o=Fr.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Lr(t).Qs({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=Yn(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),Un.Sn(i).next((function(){return n.jr(t,r)}))},t.prototype.os=function(t,e){var n=this,r=e.path,i=r.length+1,o=Fr.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new rt(_);return Lr(t).Qs({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=Yn(a);s===n.userId&&r.D(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.jr(t,u)}))},t.prototype.jr=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Pr(t).get(e).next((function(t){if(null===t)throw v();g(t.userId===n.userId),r.push(ur(n.serializer,t))})))})),Un.Sn(i).next((function(){return r}))},t.prototype.Kr=function(t,e){var n=this;return Sr(t.bi,this.userId,e).next((function(r){return t.Un((function(){n.Gr(e.batchId)})),Un.forEach(r,(function(e){return n.ii.Dr(t,e)}))}))},t.prototype.Gr=function(t){delete this.$r[t]},t.prototype.zr=function(t){var e=this;return this.Or(t).next((function(n){if(!n)return Un.resolve();var r=IDBKeyRange.lowerBound(Fr.prefixForUser(e.userId)),i=[];return Lr(t).Qs({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Yn(t[1]);i.push(o)}else r.done()})).next((function(){g(0===i.length)}))}))},t.prototype.pi=function(t,e){return xr(t,this.userId,e)},t.prototype.Hr=function(t){var e=this;return Or(t).get(this.userId).next((function(t){return t||new qr(e.userId,-1,"")}))},t}();function xr(t,e,n){var r=Fr.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Lr(t).Qs({range:o,yi:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function Sr(t,e,n){var r=t.store(Mr.store),i=t.store(Fr.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Qs({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){g(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Fr.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Un.Sn(o).next((function(){return c}))}function Pr(t){return Ir.ks(t,Mr.store)}function Lr(t){return Ir.ks(t,Fr.store)}function Or(t){return Ir.ks(t,qr.store)}var Rr=10,Vr=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;g(n<r&&n>=0&&r<=Rr);var o=new ni(e);n<1&&r>=1&&(function(t){t.createObjectStore(Ur.store)}(t),function(t){t.createObjectStore(qr.store,{keyPath:qr.keyPath}),t.createObjectStore(Mr.store,{keyPath:Mr.keyPath,autoIncrement:!0}).createIndex(Mr.userMutationsIndex,Mr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Fr.store)}(t),Yr(t),function(t){t.createObjectStore(Gr.store)}(t));var s=Un.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Kr.store),t.deleteObjectStore(Qr.store),t.deleteObjectStore(Wr.store)}(t),Yr(t)),s=s.next((function(){return function(t){var e=t.store(Wr.store),n=new Wr(0,0,O.min().A(),0);return e.put(Wr.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Mr.store).Ns().next((function(n){t.deleteObjectStore(Mr.store),t.createObjectStore(Mr.store,{keyPath:Mr.keyPath,autoIncrement:!0}).createIndex(Mr.userMutationsIndex,Mr.userMutationsKeyPath,{unique:!0});var r=e.store(Mr.store),i=n.map((function(t){return r.put(t)}));return Un.Sn(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Xr.store,{keyPath:Xr.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(zr.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Gr.store);e.createIndex(Gr.readTimeIndex,Gr.readTimeIndexPath,{unique:!1}),e.createIndex(Gr.collectionReadTimeIndex,Gr.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Gr.store).Qs((function(t,n){e+=dr(n)})).next((function(){var n=new zr(e);return t.store(zr.store).put(zr.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(qr.store),r=t.store(Mr.store);return n.Ns().next((function(n){return Un.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Ns(Mr.userMutationsIndex,i).next((function(r){return Un.forEach(r,(function(r){g(r.userId===n.userId);var i=ur(e.serializer,r);return Sr(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Kr.store),n=t.store(Gr.store);return t.store(Wr.store).get(Wr.key).next((function(t){var r=[];return n.Qs((function(n,i){var o=new V(n),s=function(t){return[0,Kn(t)]}(o);r.push(e.get(s).next((function(n){return n?Un.resolve():function(n){return e.put(new Kr(0,Kn(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Un.Sn(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Hr.store,{keyPath:Hr.keyPath});var n=e.store(Hr.store),r=new $n,i=function(t){if(r.add(t)){var e=t.S(),i=t.p();return n.put({collectionId:e,parent:Kn(i)})}};return e.store(Gr.store).Qs({yi:!0},(function(t,e){var n=new V(t);return i(n.p())})).next((function(){return e.store(Fr.store).Qs({yi:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Yn(n));return i(r.p())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Qr.store);return n.Qs((function(t,r){var i=ar(r),o=cr(e.serializer,i);return n.put(o)}))},t}(),Cr=function(t,e){this.seconds=t,this.nanoseconds=e},Ur=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ur.store="owner",Ur.key="owner";var qr=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};qr.store="mutationQueues",qr.keyPath="userId";var Mr=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Mr.store="mutations",Mr.keyPath="batchId",Mr.userMutationsIndex="userMutationsIndex",Mr.userMutationsKeyPath=["userId","batchId"];var Fr=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Kn(e)]},t.key=function(t,e,n){return[t,Kn(e),n]},t}();Fr.store="documentMutations",Fr.PLACEHOLDER=new Fr;var jr=function(t,e){this.path=t,this.readTime=e},Br=function(t,e){this.path=t,this.version=e},Gr=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Gr.store="remoteDocuments",Gr.readTimeIndex="readTimeIndex",Gr.readTimeIndexPath="readTime",Gr.collectionReadTimeIndex="collectionReadTimeIndex",Gr.collectionReadTimeIndexPath=["parentPath","readTime"];var zr=function(t){this.byteSize=t};zr.store="remoteDocumentGlobal",zr.key="remoteDocumentGlobalKey";var Qr=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Qr.store="targets",Qr.keyPath="targetId",Qr.queryTargetsIndexName="queryTargetsIndex",Qr.queryTargetsKeyPath=["canonicalId","targetId"];var Kr=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Kr.store="targetDocuments",Kr.keyPath=["targetId","path"],Kr.documentTargetsIndex="documentTargetsIndex",Kr.documentTargetsKeyPath=["path","targetId"];var Wr=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Wr.key="targetGlobalKey",Wr.store="targetGlobal";var Hr=function(t,e){this.collectionId=t,this.parent=e};function Yr(t){t.createObjectStore(Kr.store,{keyPath:Kr.keyPath}).createIndex(Kr.documentTargetsIndex,Kr.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Qr.store,{keyPath:Qr.keyPath}).createIndex(Qr.queryTargetsIndexName,Qr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Wr.store)}Hr.store="collectionParents",Hr.keyPath=["collectionId","parent"];var Xr=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Xr.store="clientMetadata",Xr.keyPath="clientId";var $r=i.__spreadArrays(i.__spreadArrays(i.__spreadArrays([qr.store,Mr.store,Fr.store,Gr.store,Qr.store,Ur.store,Wr.store,Kr.store],[Xr.store]),[zr.store]),[Hr.store]),Zr=function(){function e(t){this.db=t,12.2===e.Yr(u.getUA())&&p("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.Ui=function(t,n,r){return l("SimpleDb","Opening database:",t),new Un((function(i,o){var s=indexedDB.open(t,n);s.onsuccess=function(t){var n=t.target.result;i(new e(n))},s.onblocked=function(){o(new P(S.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new P(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},s.onupgradeneeded=function(e){l("SimpleDb",'Database "'+t+'" requires upgrade from version:',e.oldVersion);var n=e.target.result;r.createOrUpgrade(n,s.transaction,e.oldVersion,Rr).next((function(){l("SimpleDb","Database upgrade to version "+Rr+" complete")}))}})).bn()},e.delete=function(t){return l("SimpleDb","Removing database:",t),ii(window.indexedDB.deleteDatabase(t)).bn()},e.Oi=function(){if("undefined"==typeof indexedDB)return!1;if(e.Jr())return!0;var t=u.getUA(),n=e.Yr(t),r=0<n&&n<10,i=e.Xr(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.Jr=function(){var e;return void 0!==t&&"YES"===(null===(e={})||void 0===e?void 0:e.Zr)},e.ks=function(t,e){return t.store(e)},e.Yr=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.Xr=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.Ji=function(t){this.db.onversionchange=function(e){return t(e)}},e.prototype.runTransaction=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o,s,u,a;return i.__generator(this,(function(c){switch(c.label){case 0:r="readonly"===t,o=0,s=function(){var t,s,a,c,h;return i.__generator(this,(function(i){switch(i.label){case 0:++o,t=ni.open(u.db,r?"readonly":"readwrite",e),i.label=1;case 1:return i.trys.push([1,3,,4]),s=n(t).catch((function(e){return t.abort(e),Un.reject(e)})).bn(),a={},s.catch((function(){})),[4,t.to];case 2:return[2,(a.value=(i.sent(),s),a)];case 3:return c=i.sent(),h="FirebaseError"!==c.name&&o<3,l("SimpleDb","Transaction failed with error: %s. Retrying: %s.",c.message,h),h?[3,4]:[2,{value:Promise.reject(c)}];case 4:return[2]}}))},u=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(a=c.sent()))return[2,a.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db.close()},e}(),Jr=function(){function t(t){this.eo=t,this.no=!1,this.so=null}return Object.defineProperty(t.prototype,"gn",{get:function(){return this.no},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"io",{get:function(){return this.so},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.eo=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.no=!0},t.prototype.js=function(t){this.so=t},t.prototype.delete=function(){return ii(this.eo.delete())},t}(),ti=function(t){function e(e){var n=this;return(n=t.call(this,S.UNAVAILABLE,"IndexedDB transaction failed: "+e)||this).name="IndexedDbTransactionError",n}return i.__extends(e,t),e}(P);function ei(t){return"IndexedDbTransactionError"===t.name}var ni=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.ro=new zn,this.transaction.oncomplete=function(){e.ro.resolve()},this.transaction.onabort=function(){t.error?e.ro.reject(new ti(t.error)):e.ro.resolve()},this.transaction.onerror=function(t){var n=si(t.target.error);e.ro.reject(new ti(n))}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"to",{get:function(){return this.ro.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ro.reject(t),this.aborted||(l("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ri(e)},t}(),ri=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(l("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(l("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ii(n)},t.prototype.add=function(t){return l("SimpleDb","ADD",this.store.name,t,t),ii(this.store.add(t))},t.prototype.get=function(t){var e=this;return ii(this.store.get(t)).next((function(n){return void 0===n&&(n=null),l("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return l("SimpleDb","DELETE",this.store.name,t),ii(this.store.delete(t))},t.prototype.count=function(){return l("SimpleDb","COUNT",this.store.name),ii(this.store.count())},t.prototype.Ns=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.oo(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.ho=function(t,e){l("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.yi=!1;var r=this.cursor(n);return this.oo(r,(function(t,e,n){return n.delete()}))},t.prototype.Qs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.oo(r,e)},t.prototype.Fr=function(t){var e=this.cursor({});return new Un((function(n,r){e.onerror=function(t){var e=si(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.oo=function(t,e){var n=[];return new Un((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Jr(i),s=e(i.primaryKey,i.value,o);if(s instanceof Un){var u=s.catch((function(t){return o.done(),Un.reject(t)}));n.push(u)}o.gn?r():null===o.io?i.continue():i.continue(o.io)}else r()}})).next((function(){return Un.Sn(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.yi?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ii(t){return new Un((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=si(t.target.error);n(e)}}))}var oi=!1;function si(t){var e=Zr.Yr(u.getUA());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new P("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return oi||(oi=!0,setTimeout((function(){throw r}),0)),r}}return t}function ui(){return"undefined"!=typeof window?window:null}var ai=function(){function t(t,e,n,r,i){this.ao=t,this.Es=e,this.uo=n,this.op=r,this.co=i,this.lo=new zn,this.then=this.lo.promise.then.bind(this.lo.promise),this.lo.promise.catch((function(t){}))}return t._o=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.fo=setTimeout((function(){return e.do()}),t)},t.prototype.Ss=function(){return this.do()},t.prototype.cancel=function(t){null!==this.fo&&(this.clearTimeout(),this.lo.reject(new P(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.do=function(){var t=this;this.ao.Zi((function(){return null!==t.fo?(t.clearTimeout(),t.op().then((function(e){return t.lo.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.fo&&(this.co(this),clearTimeout(this.fo),this.fo=null)},t}(),ci=function(){function t(){var t=this;this.wo=Promise.resolve(),this.To=[],this.Eo=!1,this.Io=[],this.mo=null,this.Ao=!1,this.Ro=[],this.Po=new Qn(this,"async_queue_retry"),this.Vo=function(){return t.Po.vs()};var e=ui();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Vo)}return Object.defineProperty(t.prototype,"yo",{get:function(){return this.Eo},enumerable:!1,configurable:!0}),t.prototype.Zi=function(t){this.enqueue(t)},t.prototype.po=function(t){this.bo(),this.vo(t)},t.prototype.So=function(t){return this.bo(),this.vo(t)},t.prototype.Do=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return this.bo(),this.Eo?[3,2]:(this.Eo=!0,(e=ui())&&e.removeEventListener("visibilitychange",this.Vo),[4,this.So(t)]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.enqueue=function(t){return this.bo(),this.Eo?new Promise((function(t){})):this.vo(t)},t.prototype.er=function(t){var e=this;this.To.push(t),this.Zi((function(){return e.Co()}))},t.prototype.Co=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){switch(n.label){case 0:if(0===this.To.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.To[0]()];case 2:return n.sent(),this.To.shift(),this.Po.reset(),[3,4];case 3:if(!ei(t=n.sent()))throw t;return l("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.To.length>0&&this.Po.ys((function(){return e.Co()})),n.label=5;case 5:return[2]}}))}))},t.prototype.vo=function(t){var e=this,n=this.wo.then((function(){return e.Ao=!0,t().catch((function(t){throw e.mo=t,e.Ao=!1,p("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.Ao=!1,t}))}));return this.wo=n,n},t.prototype.bs=function(t,e,n){var r=this;this.bo(),this.Ro.indexOf(t)>-1&&(e=0);var i=ai._o(this,t,e,n,(function(t){return r.Fo(t)}));return this.Io.push(i),i},t.prototype.bo=function(){this.mo&&v()},t.prototype.No=function(){},t.prototype.ko=function(){return i.__awaiter(this,void 0,void 0,(function(){var t;return i.__generator(this,(function(e){switch(e.label){case 0:return[4,t=this.wo];case 1:e.sent(),e.label=2;case 2:if(t!==this.wo)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.xo=function(t){for(var e=0,n=this.Io;e<n.length;e++)if(n[e].Es===t)return!0;return!1},t.prototype.$o=function(t){var e=this;return this.ko().then((function(){e.Io.sort((function(t,e){return t.uo-e.uo}));for(var n=0,r=e.Io;n<r.length;n++){var i=r[n];if(i.Ss(),"all"!==t&&i.Es===t)break}return e.ko()}))},t.prototype.Mo=function(t){this.Ro.push(t)},t.prototype.Fo=function(t){var e=this.Io.indexOf(t);this.Io.splice(e,1)},t}();function hi(t,e){if(p("AsyncQueue",e+": "+t),ei(t))return new P(S.UNAVAILABLE,e+": "+t);throw t}function fi(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=_(n,i);return 0===s?_(r,o):s}var li=function(){function t(t){this.Oo=t,this.buffer=new rt(fi),this.Lo=0}return t.prototype.qo=function(){return++this.Lo},t.prototype.Bo=function(t){var e=[t,this.qo()];if(this.buffer.size<this.Oo)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();fi(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),pi={Uo:!1,Wo:0,Qo:0,jo:0},di=function(){function t(t,e,n){this.Ko=t,this.Go=e,this.zo=n}return t.Ho=function(e){return new t(e,t.Yo,t.Jo)},t}();di.Xo=-1,di.Zo=1048576,di.th=41943040,di.Yo=10,di.Jo=1e3,di.eh=new di(di.th,di.Yo,di.Jo),di.nh=new di(di.Xo,0,0);var yi=function(){function t(t,e){this.yr=t,this.ao=e,this.sh=!1,this.ih=null}return t.prototype.start=function(t){this.yr.params.Ko!==di.Xo&&this.rh(t)},t.prototype.stop=function(){this.ih&&(this.ih.cancel(),this.ih=null)},Object.defineProperty(t.prototype,"Hi",{get:function(){return null!==this.ih},enumerable:!1,configurable:!0}),t.prototype.rh=function(t){var e=this,n=this.sh?3e5:6e4;l("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ih=this.ao.bs("lru_garbage_collection",n,(function(){return i.__awaiter(e,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:this.ih=null,this.sh=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.oh(this.yr)];case 2:return n.sent(),[3,7];case 3:return ei(e=n.sent())?(l("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,wi(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.rh(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),vi=function(){function t(t,e){this.hh=t,this.params=e}return t.prototype.ah=function(t,e){return this.hh.pr(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.uh=function(t,e){var n=this;if(0===e)return Un.resolve(Gn.ws);var r=new li(e);return this.hh.pe(t,(function(t){return r.Bo(t.sequenceNumber)})).next((function(){return n.hh.vr(t,(function(t){return r.Bo(t)}))})).next((function(){return r.maxValue}))},t.prototype.Ei=function(t,e,n){return this.hh.Ei(t,e,n)},t.prototype.Nr=function(t,e){return this.hh.Nr(t,e)},t.prototype.lh=function(t,e){var n=this;return this.params.Ko===di.Xo?(l("LruGarbageCollector","Garbage collection skipped; disabled"),Un.resolve(pi)):this.xr(t).next((function(r){return r<n.params.Ko?(l("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Ko),pi):n._h(t,e)}))},t.prototype.xr=function(t){return this.hh.xr(t)},t.prototype._h=function(t,e){var n,r,i,o,u,a,c,h=this,p=Date.now();return this.ah(t,this.params.Go).next((function(e){return e>h.params.zo?(l("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.zo+" from "+e),r=h.params.zo):r=e,o=Date.now(),h.uh(t,r)})).next((function(r){return n=r,u=Date.now(),h.Ei(t,n,e)})).next((function(e){return i=e,a=Date.now(),h.Nr(t,n)})).next((function(t){return c=Date.now(),f()<=s.LogLevel.DEBUG&&l("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-p)+"ms\n\tDetermined least recently used "+r+" in "+(u-o)+"ms\n\tRemoved "+i+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-p)+"ms"),Un.resolve({Uo:!0,Wo:r,Qo:i,jo:t})}))},t}(),gi=function(){function t(t,e,n){this.persistence=t,this.fh=e,this.dh=new tt(_),this.wh=new x((function(t){return z(t)}),Q),this.Th=O.min(),this.jn=t.mr(n),this.Eh=t.Pr(),this.qi=t.Rr(),this.Ih=new jn(this.Eh,this.jn,this.persistence.gr()),this.fh.mh(this.Ih)}return t.prototype.Ah=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return e=this.jn,n=this.Ih,[4,this.persistence.runTransaction("Handle user change","readonly",(function(r){var i;return o.jn.Qr(r).next((function(s){return i=s,e=o.persistence.mr(t),n=new jn(o.Eh,e,o.persistence.gr()),e.Qr(r)})).next((function(t){for(var e=[],o=[],s=lt(),u=0,a=i;u<a.length;u++){var c=a[u];e.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=t;p<d.length;p++){var y=d[p];o.push(y.batchId);for(var v=0,g=y.mutations;v<g.length;v++){var m=g[v];s=s.add(m.key)}}return n.Jn(r,s).next((function(t){return{Rh:t,Ph:e,gh:o}}))}))}))];case 1:return r=i.sent(),[2,(this.jn=e,this.Ih=n,this.fh.mh(this.Ih),r)]}}))}))},t.prototype.Vh=function(t){var e,n=this,r=L.now(),i=t.reduce((function(t,e){return t.add(e.key)}),lt());return this.persistence.runTransaction("Locally write mutations","readwrite",(function(o){return n.Ih.Jn(o,i).next((function(i){e=i;for(var s=[],u=0,a=t;u<a.length;u++){var c=a[u],h=Be(c,e.get(c.key));null!=h&&s.push(new Ke(c.key,h,en(h.proto.mapValue),Ue.exists(!0)))}return n.jn.Lr(o,r,s,t)}))})).then((function(t){var n=t.In(e);return{batchId:t.batchId,Cn:n}}))},t.prototype.yh=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(n){var r=t.batch.keys(),i=e.Eh.Hs({Js:!0});return e.ph(n,t,i).next((function(){return i.apply(n)})).next((function(){return e.jn.zr(n)})).next((function(){return e.Ih.Jn(n,r)}))}))},t.prototype.bh=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",(function(n){var r;return e.jn.qr(n,t).next((function(t){return g(null!==t),r=t.keys(),e.jn.Kr(n,t)})).next((function(){return e.jn.zr(n)})).next((function(){return e.Ih.Jn(n,r)}))}))},t.prototype.Wr=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.jn.Wr(e)}))},t.prototype.ai=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.qi.ai(e)}))},t.prototype.vh=function(e){var n=this,r=e.X,i=this.dh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",(function(o){var s=n.Eh.Hs({Js:!0});i=n.dh;var u=[];e.Wt.forEach((function(e,s){var a=i.get(s);if(a){u.push(n.qi.Pi(o,e.Xt,s).next((function(){return n.qi.Ai(o,e.Yt,s)})));var c=e.resumeToken;if(c.H()>0){var h=a.tt(c,r).Z(o.vi);i=i.nt(s,h),t.Sh(a,h,e)&&u.push(n.qi.di(o,h))}}}));var a=st(),c=lt();if(e.jt.forEach((function(t,e){c=c.add(t)})),u.push(s.getEntries(o,c).next((function(t){e.jt.forEach((function(i,c){var h=t.get(i);c instanceof on&&c.version.isEqual(O.min())?(s.$n(i,r),a=a.nt(i,c)):null==h||c.version.o(h.version)>0||0===c.version.o(h.version)&&h.hasPendingWrites?(s.kn(c,r),a=a.nt(i,c)):l("LocalStore","Ignoring outdated watch update for ",i,". Current version:",h.version," Watch version:",c.version),e.Kt.has(i)&&u.push(n.persistence.ii.kr(o,i))}))}))),!r.isEqual(O.min())){var h=n.qi.ai(o).next((function(t){return n.qi.ci(o,o.vi,r)}));u.push(h)}return Un.Sn(u).next((function(){return s.apply(o)})).next((function(){return n.Ih.Xn(o,a)}))})).then((function(t){return n.dh=i,t}))},t.Sh=function(t,e,n){return g(e.resumeToken.H()>0),0===t.resumeToken.H()||e.X.m()-t.X.m()>=this.Dh||n.Yt.size+n.Jt.size+n.Xt.size>0},t.prototype.Ch=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,u,a,c,h=this;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Un.forEach(t,(function(t){return Un.forEach(t.as,(function(n){return h.persistence.ii.Ri(e,t.targetId,n)})).next((function(){return Un.forEach(t.us,(function(n){return h.persistence.ii.gi(e,t.targetId,n)}))}))}))}))];case 1:return i.sent(),[3,3];case 2:if(!ei(e=i.sent()))throw e;return l("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=t;n<r.length;n++)o=r[n],s=o.targetId,o.fromCache||(u=this.dh.get(s),a=u.X,c=u.et(a),this.dh=this.dh.nt(s,c));return[2]}}))}))},t.prototype.Fh=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",(function(n){return void 0===t&&(t=-1),e.jn.Ur(n,t)}))},t.prototype.Nh=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",(function(n){return e.Ih.Gn(n,t)}))},t.prototype.kh=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite",(function(n){var r;return e.qi.mi(n,t).next((function(i){return i?(r=i,Un.resolve(r)):e.qi.ri(n).next((function(i){return r=new X(t,i,0,n.vi),e.qi.li(n,r).next((function(){return r}))}))}))})).then((function(n){var r=e.dh.get(n.targetId);return(null===r||n.X.o(r.X)>0)&&(e.dh=e.dh.nt(n.targetId,n),e.wh.set(t,n.targetId)),n}))},t.prototype.mi=function(t,e){var n=this.wh.get(e);return void 0!==n?Un.resolve(this.dh.get(n)):this.qi.mi(t,e)},t.prototype.xh=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:n=this.dh.get(t),r=e?"readwrite":"readwrite-primary",i.label=1;case 1:return i.trys.push([1,4,,5]),e?[3,3]:[4,this.persistence.runTransaction("Release target",r,(function(t){return s.persistence.ii.removeTarget(t,n)}))];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!ei(o=i.sent()))throw o;return l("LocalStore","Failed to update sequence numbers for target "+t+": "+o),[3,5];case 5:return this.dh=this.dh.remove(t),this.wh.delete(n.target),[2]}}))}))},t.prototype.$h=function(t,e){var n=this,r=O.min(),i=lt();return this.persistence.runTransaction("Execute query","readonly",(function(o){return n.mi(o,pn(t)).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.qi.Vi(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.fh.ts(o,t,e?r:O.min(),e?i:lt())})).next((function(t){return{documents:t,Mh:i}}))}))},t.prototype.ph=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=Un.resolve();return o.forEach((function(r){s=s.next((function(){return n.Mn(t,r)})).next((function(t){var o=t,s=e.An.get(r);g(null!==s),(!o||o.version.o(s)<0)&&(o=i.wn(r,o,e))&&n.kn(o,e.mn)}))})),s.next((function(){return r.jn.Kr(t,i)}))},t.prototype.oh=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.lh(n,e.dh)}))},t}();function mi(t,e){var n=m(t),r=m(n.qi),i=n.dh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Me(t,e).next((function(t){return t?t.target:null}))}))}function wi(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){if(t.code!==S.FAILED_PRECONDITION||t.message!==Mn)throw t;return l("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}gi.Dh=3e8;var bi=function(){function t(){this.Oh=new rt(_i.Lh),this.qh=new rt(_i.Bh)}return t.prototype._=function(){return this.Oh._()},t.prototype.Ri=function(t,e){var n=new _i(t,e);this.Oh=this.Oh.add(n),this.qh=this.qh.add(n)},t.prototype.Uh=function(t,e){var n=this;t.forEach((function(t){return n.Ri(t,e)}))},t.prototype.gi=function(t,e){this.Wh(new _i(t,e))},t.prototype.Qh=function(t,e){var n=this;t.forEach((function(t){return n.gi(t,e)}))},t.prototype.jh=function(t){var e=this,n=new q(new V([])),r=new _i(n,t),i=new _i(n,t+1),o=[];return this.qh.vt([r,i],(function(t){e.Wh(t),o.push(t.key)})),o},t.prototype.Kh=function(){var t=this;this.Oh.forEach((function(e){return t.Wh(e)}))},t.prototype.Wh=function(t){this.Oh=this.Oh.delete(t),this.qh=this.qh.delete(t)},t.prototype.Gh=function(t){var e=new q(new V([])),n=new _i(e,t),r=new _i(e,t+1),i=lt();return this.qh.vt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.pi=function(t){var e=new _i(t,0),n=this.Oh.Dt(e);return null!==n&&t.isEqual(n.key)},t}(),_i=function(){function t(t,e){this.key=t,this.zh=e}return t.Lh=function(t,e){return q.P(t.key,e.key)||_(t.zh,e.zh)},t.Bh=function(t,e){return _(t.zh,e.zh)||q.P(t.key,e.key)},t}(),Ii=function(){function t(t){this.uid=t}return t.prototype.Mr=function(){return null!=this.uid},t.prototype.Hh=function(){return this.Mr()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();Ii.UNAUTHENTICATED=new Ii(null),Ii.Yh=new Ii("google-credentials-uid"),Ii.Jh=new Ii("first-party-uid");var Ei=function(t,e){this.user=e,this.type="OAuth",this.Xh={},this.Xh.Authorization="Bearer "+t},Ti=function(){function t(){this.Zh=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.ta=function(){},t.prototype.ea=function(t){this.Zh=t,t(Ii.UNAUTHENTICATED)},t.prototype.na=function(){this.Zh=null},t}(),Ni=function(){function t(t){var e=this;this.sa=null,this.currentUser=Ii.UNAUTHENTICATED,this.ia=!1,this.ra=0,this.Zh=null,this.forceRefresh=!1,this.sa=function(){e.ra++,e.currentUser=e.oa(),e.ia=!0,e.Zh&&e.Zh(e.currentUser)},this.ra=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.sa):(this.sa(null),t.get().then((function(t){e.auth=t,e.sa&&e.auth.addAuthTokenListener(e.sa)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.ra,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.ra!==e?(l("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(g("string"==typeof n.accessToken),new Ei(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.ta=function(){this.forceRefresh=!0},t.prototype.ea=function(t){this.Zh=t,this.ia&&t(this.currentUser)},t.prototype.na=function(){this.auth&&this.auth.removeAuthTokenListener(this.sa),this.sa=null,this.Zh=null},t.prototype.oa=function(){var t=this.auth&&this.auth.getUid();return g(null===t||"string"==typeof t),new Ii(t)},t}(),Ai=function(){function t(t,e){this.ha=t,this.aa=e,this.type="FirstParty",this.user=Ii.Jh}return Object.defineProperty(t.prototype,"Xh",{get:function(){var t={"X-Goog-AuthUser":this.aa},e=this.ha.auth.ua([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),ki=function(){function t(t,e){this.ha=t,this.aa=e}return t.prototype.getToken=function(){return Promise.resolve(new Ai(this.ha,this.aa))},t.prototype.ea=function(t){t(Ii.Jh)},t.prototype.na=function(){},t.prototype.ta=function(){},t}(),Di=function(){function t(t,e,n,r,i,o){this.Ts=t,this.ca=n,this.la=r,this._a=i,this.listener=o,this.state=0,this.fa=0,this.da=null,this.stream=null,this.Po=new Qn(t,e)}return t.prototype.wa=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.Ta=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.Ea()},t.prototype.stop=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.wa()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.Ia=function(){this.state=0,this.Po.reset()},t.prototype.ma=function(){var t=this;this.Ta()&&null===this.da&&(this.da=this.Ts.bs(this.ca,6e4,(function(){return t.Aa()})))},t.prototype.Ra=function(t){this.Pa(),this.stream.send(t)},t.prototype.Aa=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.Ta()?[2,this.close(0)]:[2]}))}))},t.prototype.Pa=function(){this.da&&(this.da.cancel(),this.da=null)},t.prototype.close=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(n){switch(n.label){case 0:return this.Pa(),this.Po.cancel(),this.fa++,3!==t?this.Po.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(p(e.toString()),p("Using maximum backoff delay to prevent overloading the backend."),this.Po.Vs()):e&&e.code===S.UNAUTHENTICATED&&this._a.ta(),null!==this.stream&&(this.ga(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Va(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ga=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.ya(this.fa),n=this.fa;this._a.getToken().then((function(e){t.fa===n&&t.pa(e)}),(function(n){e((function(){var e=new P(S.UNKNOWN,"Fetching auth token failed: "+n.message);return t.ba(e)}))}))},t.prototype.pa=function(t){var e=this,n=this.ya(this.fa);this.stream=this.va(t),this.stream.Sa((function(){n((function(){return e.state=2,e.listener.Sa()}))})),this.stream.Va((function(t){n((function(){return e.ba(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.Ea=function(){var t=this;this.state=4,this.Po.ys((function(){return i.__awaiter(t,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.ba=function(t){return l("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.ya=function(t){var e=this;return function(n){e.Ts.Zi((function(){return e.fa===t?n():(l("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),xi=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,s}return i.__extends(e,t),e.prototype.va=function(t){return this.la.Da("Listen",t)},e.prototype.onMessage=function(t){this.Po.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:v()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Oe?(g(void 0===e||"string"==typeof e),W.fromBase64String(e||"")):(g(void 0===e||e instanceof Uint8Array),W.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?S.UNKNOWN:J(t.code);return new P(e,t.message||"")}(s);n=new It(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;var a=e.documentChange;a.document,a.document.name,a.document.updateTime;var c=ie(t,a.document.name),h=te(a.document.updateTime),f=new Je({mapValue:{fields:a.document.fields}}),l=new rn(c,h,f,{}),p=a.targetIds||[],d=a.removedTargetIds||[];n=new bt(p,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;var y=e.documentDelete;y.document;var m=ie(t,y.document),w=y.readTime?te(y.readTime):O.min(),b=new on(m,w),_=y.removedTargetIds||[];n=new bt([],_,b.key,b)}else if("documentRemove"in e){e.documentRemove;var I=e.documentRemove;I.document;var E=ie(t,I.document),T=I.removedTargetIds||[];n=new bt([],T,E,null)}else{if(!("filter"in e))return v();e.filter;var N=e.filter;N.targetId;var A=N.count||0,k=new $(A),D=N.targetId;n=new _t(D,k)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return O.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?O.min():e.readTime?te(e.readTime):O.min()}(t);return this.listener.Ca(e,n)},e.prototype.Fa=function(t){var e={};e.database=ue(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=K(r)?{documents:le(t,r)}:{query:pe(t,r)}).targetId=e.targetId,e.resumeToken.H()>0&&(n.resumeToken=Zt(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return v()}}(0,e.J);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Ra(e)},e.prototype.Na=function(t){var e={};e.database=ue(this.serializer),e.removeTarget=t,this.Ra(e)},e}(Di),Si=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,s.ka=!1,s}return i.__extends(e,t),Object.defineProperty(e.prototype,"xa",{get:function(){return this.ka},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.ka=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ga=function(){this.ka&&this.$a([])},e.prototype.va=function(t){return this.la.Da("Write",t)},e.prototype.onMessage=function(t){if(g(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ka){this.Po.reset();var e=function(t,e){return t&&t.length>0?(g(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?te(t.updateTime):te(e);n.isEqual(O.min())&&(n=te(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Ce(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=te(t.commitTime);return this.listener.Ma(n,e)}return g(!t.writeResults||0===t.writeResults.length),this.ka=!0,this.listener.Oa()},e.prototype.La=function(){var t={};t.database=ue(this.serializer),this.Ra(t)},e.prototype.$a=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return he(e.serializer,t)}))};this.Ra(n)},e}(Di),Pi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).credentials=e,r.serializer=n,r.qa=!1,r}return i.__extends(e,t),e.prototype.Ba=function(){if(this.qa)throw new P(S.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.start=function(t){this.la=t},e.prototype.Ua=function(t,e,n){var r=this;return this.Ba(),this.credentials.getToken().then((function(i){return r.la.Ua(t,e,n,i)})).catch((function(t){throw t.code===S.UNAUTHENTICATED&&r.credentials.ta(),t}))},e.prototype.Wa=function(t,e,n){var r=this;return this.Ba(),this.credentials.getToken().then((function(i){return r.la.Wa(t,e,n,i)})).catch((function(t){throw t.code===S.UNAUTHENTICATED&&r.credentials.ta(),t}))},e.prototype.Qa=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.qa=!1,[2]}))}))},e}((function(){})),Li=function(){function t(t,e){this.ao=t,this.ja=e,this.state="Unknown",this.Ka=0,this.Ga=null,this.za=!0}return t.prototype.Ha=function(){var t=this;0===this.Ka&&(this.Ya("Unknown"),this.Ga=this.ao.bs("online_state_timeout",1e4,(function(){return t.Ga=null,t.Ja("Backend didn't respond within 10 seconds."),t.Ya("Offline"),Promise.resolve()})))},t.prototype.Xa=function(t){"Online"===this.state?this.Ya("Unknown"):(this.Ka++,this.Ka>=1&&(this.Za(),this.Ja("Connection failed 1 times. Most recent error: "+t.toString()),this.Ya("Offline")))},t.prototype.set=function(t){this.Za(),this.Ka=0,"Online"===t&&(this.za=!1),this.Ya(t)},t.prototype.Ya=function(t){t!==this.state&&(this.state=t,this.ja(t))},t.prototype.Ja=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.za?(p(e),this.za=!1):l("OnlineStateTracker",e)},t.prototype.Za=function(){null!==this.Ga&&(this.Ga.cancel(),this.Ga=null)},t}(),Oi=function(){function t(t,e,n,r,o){var s=this;this.tu=t,this.eu=e,this.ao=n,this.nu=[],this.su=new Map,this.iu=null,this.ru=new Set,this.ou=o,this.ou.hu((function(t){n.Zi((function(){return i.__awaiter(s,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.au()?(l("RemoteStore","Restarting streams for network reachability change."),[4,this.uu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.cu=new Li(n,r),this.lu=function(t,e,n){var r=m(t);return r.Ba(),new xi(e,r.la,r.credentials,r.serializer,n)}(this.eu,n,{Sa:this._u.bind(this),Va:this.fu.bind(this),Ca:this.du.bind(this)}),this.wu=function(t,e,n){var r=m(t);return r.Ba(),new Si(e,r.la,r.credentials,r.serializer,n)}(this.eu,n,{Sa:this.Tu.bind(this),Va:this.Eu.bind(this),Oa:this.Iu.bind(this),Ma:this.Ma.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return this.ru.delete(0),this.mu()},t.prototype.mu=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.au()?(this.Au()?this.Ru():this.cu.set("Unknown"),[4,this.Pu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.disableNetwork=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.ru.add(0),[4,this.gu()];case 1:return t.sent(),this.cu.set("Offline"),[2]}}))}))},t.prototype.gu=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this.wu.stop()];case 1:return t.sent(),[4,this.lu.stop()];case 2:return t.sent(),this.nu.length>0&&(l("RemoteStore","Stopping write stream with "+this.nu.length+" pending writes"),this.nu=[]),this.Vu(),[2]}}))}))},t.prototype._r=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return l("RemoteStore","RemoteStore shutting down."),this.ru.add(5),[4,this.gu()];case 1:return t.sent(),this.ou._r(),this.cu.set("Unknown"),[2]}}))}))},t.prototype.listen=function(t){this.su.has(t.targetId)||(this.su.set(t.targetId,t),this.Au()?this.Ru():this.lu.Ta()&&this.yu(t))},t.prototype.pu=function(t){this.su.delete(t),this.lu.Ta()&&this.bu(t),0===this.su.size&&(this.lu.Ta()?this.lu.ma():this.au()&&this.cu.set("Unknown"))},t.prototype.Me=function(t){return this.su.get(t)||null},t.prototype.$e=function(t){return this.vu.$e(t)},t.prototype.yu=function(t){this.iu.de(t.targetId),this.lu.Fa(t)},t.prototype.bu=function(t){this.iu.de(t),this.lu.Na(t)},t.prototype.Ru=function(){this.iu=new Tt(this),this.lu.start(),this.cu.Ha()},t.prototype.Au=function(){return this.au()&&!this.lu.wa()&&this.su.size>0},t.prototype.au=function(){return 0===this.ru.size},t.prototype.Vu=function(){this.iu=null},t.prototype._u=function(){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(e){return this.su.forEach((function(e,n){t.yu(e)})),[2]}))}))},t.prototype.fu=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return this.Vu(),this.Au()?(this.cu.Xa(t),this.Ru()):this.cu.set("Unknown"),[2]}))}))},t.prototype.du=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:if(this.cu.set("Online"),!(t instanceof It&&2===t.state&&t.cause))return[3,6];i.label=1;case 1:return i.trys.push([1,3,,5]),[4,this.Su(t)];case 2:return i.sent(),[3,5];case 3:return n=i.sent(),l("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),[4,this.Du(n)];case 4:return i.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof bt?this.iu.Pe(t):t instanceof _t?this.iu.De(t):this.iu.ye(t),e.isEqual(O.min()))return[3,13];i.label=7;case 7:return i.trys.push([7,11,,13]),[4,this.tu.ai()];case 8:return r=i.sent(),e.o(r)>=0?[4,this.Cu(e)]:[3,10];case 9:i.sent(),i.label=10;case 10:return[3,13];case 11:return l("RemoteStore","Failed to raise snapshot:",o=i.sent()),[4,this.Du(o)];case 12:return i.sent(),[3,13];case 13:return[2]}}))}))},t.prototype.Du=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n=this;return i.__generator(this,(function(r){switch(r.label){case 0:if(!ei(t))throw t;return this.ru.add(1),[4,this.gu()];case 1:return r.sent(),this.cu.set("Offline"),e||(e=function(){return n.tu.ai()}),this.ao.er((function(){return i.__awaiter(n,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return l("RemoteStore","Retrying IndexedDB access"),[4,e()];case 1:return t.sent(),this.ru.delete(1),[4,this.mu()];case 2:return t.sent(),[2]}}))}))})),[2]}}))}))},t.prototype.Fu=function(t){var e=this;return t().catch((function(n){return e.Du(n,t)}))},t.prototype.Cu=function(t){var e=this,n=this.iu.Ne(t);return n.Wt.forEach((function(n,r){if(n.resumeToken.H()>0){var i=e.su.get(r);i&&e.su.set(r,i.tt(n.resumeToken,t))}})),n.Qt.forEach((function(t){var n=e.su.get(t);if(n){e.su.set(t,n.tt(W.Y,n.X)),e.bu(t);var r=new X(n.target,t,1,n.sequenceNumber);e.yu(r)}})),this.vu.vh(n)},t.prototype.Su=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:e=t.cause,n=0,r=t.targetIds,i.label=1;case 1:return n<r.length?(o=r[n],this.su.has(o)?[4,this.vu.Nu(o,e)]:[3,3]):[3,5];case 2:i.sent(),this.su.delete(o),this.iu.removeTarget(o),i.label=3;case 3:i.label=4;case 4:return n++,[3,1];case 5:return[2]}}))}))},t.prototype.Pu=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n;return i.__generator(this,(function(r){switch(r.label){case 0:t=this.nu.length>0?this.nu[this.nu.length-1].batchId:-1,r.label=1;case 1:if(!this.ku())return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,this.tu.Fh(t)];case 3:return null===(e=r.sent())?(0===this.nu.length&&this.wu.ma(),[3,7]):(t=e.batchId,this.xu(e),[3,6]);case 4:return n=r.sent(),[4,this.Du(n)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return this.$u()&&this.Mu(),[2]}}))}))},t.prototype.ku=function(){return this.au()&&this.nu.length<10},t.prototype.Ou=function(){return this.nu.length},t.prototype.xu=function(t){this.nu.push(t),this.wu.Ta()&&this.wu.xa&&this.wu.$a(t.mutations)},t.prototype.$u=function(){return this.au()&&!this.wu.wa()&&this.nu.length>0},t.prototype.Mu=function(){this.wu.start()},t.prototype.Tu=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.wu.La(),[2]}))}))},t.prototype.Iu=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n;return i.__generator(this,(function(r){for(t=0,e=this.nu;t<e.length;t++)n=e[t],this.wu.$a(n.mutations);return[2]}))}))},t.prototype.Ma=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return n=this.nu.shift(),r=Cn.from(n,t,e),[4,this.Fu((function(){return o.vu.Lu(r)}))];case 1:return i.sent(),[4,this.Pu()];case 2:return i.sent(),[2]}}))}))},t.prototype.Eu=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return t&&this.wu.xa?[4,this.qu(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.$u()&&this.Mu(),[2]}}))}))},t.prototype.qu=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r=this;return i.__generator(this,(function(i){switch(i.label){case 0:return Z(n=t.code)&&n!==S.ABORTED?(e=this.nu.shift(),this.wu.Ia(),[4,this.Fu((function(){return r.vu.Bu(e.batchId,t)}))]):[3,3];case 1:return i.sent(),[4,this.Pu()];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.uu=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.ru.add(4),[4,this.gu()];case 1:return t.sent(),this.cu.set("Unknown"),this.wu.Ia(),this.lu.Ia(),this.ru.delete(4),[4,this.mu()];case 2:return t.sent(),[2]}}))}))},t.prototype.Uu=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return this.ao.No(),l("RemoteStore","RemoteStore received new credentials"),this.ru.add(3),[4,this.gu()];case 1:return e.sent(),this.cu.set("Unknown"),[4,this.vu.Uu(t)];case 2:return e.sent(),this.ru.delete(3),[4,this.mu()];case 3:return e.sent(),[2]}}))}))},t.prototype.Wu=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return t?(this.ru.delete(2),[4,this.mu()]):[3,2];case 1:return e.sent(),[3,5];case 2:return t?[3,4]:(this.ru.add(2),[4,this.gu()]);case 3:e.sent(),this.cu.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}}))}))},t}();function Ri(t,e){return"firestore_clients_"+t+"_"+e}function Vi(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Mr()&&(r+="_"+e.uid),r}function Ci(t,e){return"firestore_targets_"+t+"_"+e}var Ui=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Qu=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new P(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(p("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.ju=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),qi=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Qu=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new P(r.error.code,r.error.message)),i?new t(e,r.state,o):(p("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.ju=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Mi=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Qu=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=dt(),s=0;i&&s<r.activeTargetIds.length;++s)i=j(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(p("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Fi=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Qu=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(p("SharedClientState","Failed to parse online state: "+e),null)},t}(),ji=function(){function t(){this.activeTargetIds=dt()}return t.prototype.Ku=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Gu=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ju=function(){var t={activeTargetIds:this.activeTargetIds.F(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Bi=function(){function t(t,e,n,r,i){this.window=t,this.Ts=e,this.persistenceKey=n,this.zu=r,this.vu=null,this.ja=null,this.ls=null,this.Hu=this.Yu.bind(this),this.Ju=new tt(_),this.Hi=!1,this.Xu=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Zu=Ri(this.persistenceKey,this.zu),this.tc=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Ju=this.Ju.nt(this.zu,new ji),this.ec=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.nc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.sc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.ic=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Hu)}return t.Oi=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n,r,o,s,u,a,c,h,f,l=this;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.vu.Ir()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.zu&&(o=this.getItem(Ri(this.persistenceKey,r)))&&(s=Mi.Qu(r,o))&&(this.Ju=this.Ju.nt(s.clientId,s));for(this.rc(),(u=this.storage.getItem(this.ic))&&(a=this.oc(u))&&this.hc(a),c=0,h=this.Xu;c<h.length;c++)f=h[c],this.Yu(f);return this.Xu=[],this.window.addEventListener("unload",(function(){return l._r()})),this.Hi=!0,[2]}}))}))},t.prototype.ds=function(t){this.setItem(this.tc,JSON.stringify(t))},t.prototype.ac=function(){return this.uc(this.Ju)},t.prototype.cc=function(t){var e=!1;return this.Ju.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.lc=function(t){this._c(t,"pending")},t.prototype.fc=function(t,e,n){this._c(t,e,n),this.dc(t)},t.prototype.wc=function(t){var e="not-current";if(this.cc(t)){var n=this.storage.getItem(Ci(this.persistenceKey,t));if(n){var r=qi.Qu(t,n);r&&(e=r.state)}}return this.Tc.Ku(t),this.rc(),e},t.prototype.Ec=function(t){this.Tc.Gu(t),this.rc()},t.prototype.Ic=function(t){return this.Tc.activeTargetIds.has(t)},t.prototype.mc=function(t){this.removeItem(Ci(this.persistenceKey,t))},t.prototype.Ac=function(t,e,n){this.Rc(t,e,n)},t.prototype.Ah=function(t,e,n){var r=this;e.forEach((function(t){r.dc(t)})),this.currentUser=t,n.forEach((function(t){r.lc(t)}))},t.prototype.Pc=function(t){this.gc(t)},t.prototype._r=function(){this.Hi&&(this.window.removeEventListener("storage",this.Hu),this.removeItem(this.Zu),this.Hi=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return l("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){l("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){l("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Yu=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(l("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Zu)return void p("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ts.er((function(){return i.__awaiter(e,void 0,void 0,(function(){var t,e,r,o,s,u;return i.__generator(this,(function(i){if(this.Hi){if(null!==n.key)if(this.ec.test(n.key)){if(null==n.newValue)return t=this.Vc(n.key),[2,this.yc(t,null)];if(e=this.pc(n.key,n.newValue))return[2,this.yc(e.clientId,e)]}else if(this.nc.test(n.key)){if(null!==n.newValue&&(r=this.bc(n.key,n.newValue)))return[2,this.vc(r)]}else if(this.sc.test(n.key)){if(null!==n.newValue&&(o=this.Sc(n.key,n.newValue)))return[2,this.Dc(o)]}else if(n.key===this.ic){if(null!==n.newValue&&(s=this.oc(n.newValue)))return[2,this.hc(s)]}else n.key===this.tc&&(u=function(t){var e=Gn.ws;if(null!=t)try{var n=JSON.parse(t);g("number"==typeof n),e=n}catch(t){p("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Gn.ws&&this.ls(u)}else this.Xu.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Tc",{get:function(){return this.Ju.get(this.zu)},enumerable:!1,configurable:!0}),t.prototype.rc=function(){this.setItem(this.Zu,this.Tc.ju())},t.prototype._c=function(t,e,n){var r=new Ui(this.currentUser,t,e,n),i=Vi(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ju())},t.prototype.dc=function(t){var e=Vi(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.gc=function(t){var e={clientId:this.zu,onlineState:t};this.storage.setItem(this.ic,JSON.stringify(e))},t.prototype.Rc=function(t,e,n){var r=Ci(this.persistenceKey,t),i=new qi(t,e,n);this.setItem(r,i.ju())},t.prototype.Vc=function(t){var e=this.ec.exec(t);return e?e[1]:null},t.prototype.pc=function(t,e){var n=this.Vc(t);return Mi.Qu(n,e)},t.prototype.bc=function(t,e){var n=this.nc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ui.Qu(new Ii(i),r,e)},t.prototype.Sc=function(t,e){var n=this.sc.exec(t),r=Number(n[1]);return qi.Qu(r,e)},t.prototype.oc=function(t){return Fi.Qu(t)},t.prototype.vc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.vu.Cc(t.batchId,t.state,t.error)]:(l("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.Dc=function(t){return this.vu.Fc(t.targetId,t.state,t.error)},t.prototype.yc=function(t,e){var n=this,r=e?this.Ju.nt(t,e):this.Ju.remove(t),i=this.uc(this.Ju),o=this.uc(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.vu.Nc(s,u).then((function(){n.Ju=r}))},t.prototype.hc=function(t){this.Ju.get(t.clientId)&&this.ja(t.onlineState)},t.prototype.uc=function(t){var e=dt();return t.forEach((function(t,n){e=e.Ct(n.activeTargetIds)})),e},t}(),Gi=function(){function t(){this.kc=new ji,this.xc={},this.ja=null,this.ls=null}return t.prototype.lc=function(t){},t.prototype.fc=function(t,e,n){},t.prototype.wc=function(t){return this.kc.Ku(t),this.xc[t]||"not-current"},t.prototype.Ac=function(t,e,n){this.xc[t]=e},t.prototype.Ec=function(t){this.kc.Gu(t)},t.prototype.Ic=function(t){return this.kc.activeTargetIds.has(t)},t.prototype.mc=function(t){delete this.xc[t]},t.prototype.ac=function(){return this.kc.activeTargetIds},t.prototype.cc=function(t){return this.kc.activeTargetIds.has(t)},t.prototype.start=function(){return this.kc=new ji,Promise.resolve()},t.prototype.Ah=function(t,e,n){},t.prototype.Pc=function(t){},t.prototype._r=function(){},t.prototype.ds=function(t){},t}(),zi=function(t){this.key=t},Qi=function(t){this.key=t},Ki=function(){function t(t,e){this.query=t,this.$c=e,this.Mc=null,this.Ht=!1,this.Oc=lt(),this.Lt=lt(),this.Lc=_n(t),this.qc=new yt(this.Lc)}return Object.defineProperty(t.prototype,"Bc",{get:function(){return this.$c},enumerable:!1,configurable:!0}),t.prototype.Uc=function(t,e){var n=this,r=e?e.Wc:new vt,i=e?e.qc:this.qc,o=e?e.Lt:this.Lt,s=i,u=!1,a=this.query.hn()&&i.size===this.query.limit?i.last():null,c=this.query.an()&&i.size===this.query.limit?i.first():null;if(t.ot((function(t,e){var h=i.get(t),f=e instanceof rn?e:null;f&&(f=bn(n.query,f)?f:null);var l=!!h&&n.Lt.has(h.key),p=!!f&&(f.Ke||n.Lt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Qc(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.Lc(f,a)>0||c&&n.Lc(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),this.query.hn()||this.query.an())for(;s.size>this.query.limit;){var h=this.query.hn()?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{qc:s,Wc:r,jc:u,Lt:o}},t.prototype.Qc=function(t,e){return t.Ke&&e.hasCommittedMutations&&!e.Ke},t.prototype.qn=function(t,e,n){var r=this,i=this.qc;this.qc=t.qc,this.Lt=t.Lt;var o=t.Wc.Mt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v()}};return n(t)-n(e)}(t.type,e.type)||r.Lc(t.doc,e.doc)})),this.Kc(n);var s=e?this.Gc():[],u=0===this.Oc.size&&this.Ht?1:0,a=u!==this.Mc;return this.Mc=u,0!==o.length||a?{snapshot:new gt(this.query,t.qc,i,o,t.Lt,0===u,a,!1),zc:s}:{zc:s}},t.prototype.Hc=function(t){return this.Ht&&"Offline"===t?(this.Ht=!1,this.qn({qc:this.qc,Wc:new vt,Lt:this.Lt,jc:!1},!1)):{zc:[]}},t.prototype.Yc=function(t){return!this.$c.has(t)&&!!this.qc.has(t)&&!this.qc.get(t).Ke},t.prototype.Kc=function(t){var e=this;t&&(t.Yt.forEach((function(t){return e.$c=e.$c.add(t)})),t.Jt.forEach((function(t){})),t.Xt.forEach((function(t){return e.$c=e.$c.delete(t)})),this.Ht=t.Ht)},t.prototype.Gc=function(){var t=this;if(!this.Ht)return[];var e=this.Oc;this.Oc=lt(),this.qc.forEach((function(e){t.Yc(e.key)&&(t.Oc=t.Oc.add(e.key))}));var n=[];return e.forEach((function(e){t.Oc.has(e)||n.push(new Qi(e))})),this.Oc.forEach((function(t){e.has(t)||n.push(new zi(t))})),n},t.prototype.Jc=function(t){this.$c=t.Mh,this.Oc=lt();var e=this.Uc(t.documents);return this.qn(e,!0)},t.prototype.Xc=function(){return gt.Ut(this.query,this.qc,this.Lt,0===this.Mc)},t}(),Wi=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Hi=function(t){this.key=t,this.Zc=!1},Yi=function(){function t(t,e,n,r,i,o){this.tu=t,this.tl=e,this.eu=n,this.el=r,this.currentUser=i,this.nl=o,this.sl=null,this.il=new x((function(t){return mn(t)}),gn),this.rl=new Map,this.ol=[],this.hl=new tt(q.P),this.al=new Map,this.ul=new bi,this.cl={},this.ll=new Map,this._l=yr.si(),this.onlineState="Unknown",this.fl=void 0}return Object.defineProperty(t.prototype,"dl",{get:function(){return!0===this.fl},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){this.sl=t},t.prototype.listen=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s;return i.__generator(this,(function(i){switch(i.label){case 0:return this.wl("listen()"),(r=this.il.get(t))?(e=r.targetId,this.el.wc(e),n=r.view.Xc(),[3,4]):[3,1];case 1:return[4,this.tu.kh(pn(t))];case 2:return o=i.sent(),s=this.el.wc(o.targetId),e=o.targetId,[4,this.Tl(t,e,"current"===s)];case 3:n=i.sent(),this.dl&&this.tl.listen(o),i.label=4;case 4:return[2,n]}}))}))},t.prototype.Tl=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o,s,u,a,c;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.tu.$h(t,!0)];case 1:return r=i.sent(),o=new Ki(t,r.Mh),s=o.Uc(r.documents),u=wt.zt(e,n&&"Offline"!==this.onlineState),a=o.qn(s,this.dl,u),this.El(e,a.zc),c=new Wi(t,e,o),[2,(this.il.set(t,c),this.rl.has(e)?this.rl.get(e).push(t):this.rl.set(e,[t]),a.snapshot)]}}))}))},t.prototype.pu=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.wl("unlisten()"),e=this.il.get(t),(n=this.rl.get(e.targetId)).length>1?[2,(this.rl.set(e.targetId,n.filter((function(e){return!gn(e,t)}))),void this.il.delete(t))]:this.dl?(this.el.Ec(e.targetId),this.el.cc(e.targetId)?[3,2]:[4,this.tu.xh(e.targetId,!1).then((function(){r.el.mc(e.targetId),r.tl.pu(e.targetId),r.Il(e.targetId)})).catch(wi)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.Il(e.targetId),[4,this.tu.xh(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},t.prototype.write=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:this.wl("write()"),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.tu.Vh(t)];case 2:return n=i.sent(),this.el.lc(n.batchId),this.ml(n.batchId,e),[4,this.Al(n.Cn)];case 3:return i.sent(),[4,this.tl.Pu()];case 4:return i.sent(),[3,6];case 5:return r=i.sent(),o=hi(r,"Failed to persist write"),e.reject(o),[3,6];case 6:return[2]}}))}))},t.prototype.vh=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:this.wl("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.tu.vh(t)];case 2:return e=r.sent(),t.Wt.forEach((function(t,e){var r=n.al.get(e);r&&(g(t.Yt.size+t.Jt.size+t.Xt.size<=1),t.Yt.size>0?r.Zc=!0:t.Jt.size>0?g(r.Zc):t.Xt.size>0&&(g(r.Zc),r.Zc=!1))})),[4,this.Al(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,wi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.Hc=function(t,e){if(this.dl&&0===e||!this.dl&&1===e){this.wl("applyOnlineStateChange()");var n=[];this.il.forEach((function(e,r){var i=r.view.Hc(t);i.snapshot&&n.push(i.snapshot)})),this.sl.Rl(t),this.sl.Ca(n),this.onlineState=t,this.dl&&this.el.Pc(t)}},t.prototype.Nu=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,u,a=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.wl("rejectListens()"),this.el.Ac(t,"rejected",e),n=this.al.get(t),(r=n&&n.key)?(o=(o=new tt(q.P)).nt(r,new on(r,O.min())),s=lt().add(r),u=new mt(O.min(),new Map,new rt(_),o,s),[4,this.vh(u)]):[3,2];case 1:return i.sent(),this.hl=this.hl.remove(r),this.al.delete(t),this.Pl(),[3,4];case 2:return[4,this.tu.xh(t,!1).then((function(){return a.Il(t,e)})).catch(wi)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},t.prototype.Lu=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n;return i.__generator(this,(function(r){switch(r.label){case 0:this.wl("applySuccessfulWrite()"),e=t.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.tu.yh(t)];case 2:return n=r.sent(),this.gl(e,null),this.Vl(e),this.el.fc(e,"acknowledged"),[4,this.Al(n)];case 3:return r.sent(),[3,6];case 4:return[4,wi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.Bu=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n;return i.__generator(this,(function(r){switch(r.label){case 0:this.wl("rejectFailedWrite()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.tu.bh(t)];case 2:return n=r.sent(),this.gl(t,e),this.Vl(t),this.el.fc(t,"rejected",e),[4,this.Al(n)];case 3:return r.sent(),[3,6];case 4:return[4,wi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.yl=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:this.tl.au()||l("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.tu.Wr()];case 2:return-1===(e=i.sent())?[2,void t.resolve()]:((n=this.ll.get(e)||[]).push(t),this.ll.set(e,n),[3,4]);case 3:return r=i.sent(),o=hi(r,"Initialization of waitForPendingWrites() operation failed"),t.reject(o),[3,4];case 4:return[2]}}))}))},t.prototype.Vl=function(t){(this.ll.get(t)||[]).forEach((function(t){t.resolve()})),this.ll.delete(t)},t.prototype.pl=function(t){this.ll.forEach((function(e){e.forEach((function(e){e.reject(new P(S.CANCELLED,t))}))})),this.ll.clear()},t.prototype.ml=function(t,e){var n=this.cl[this.currentUser.Hh()];n||(n=new tt(_)),n=n.nt(t,e),this.cl[this.currentUser.Hh()]=n},t.prototype.gl=function(t,e){var n=this.cl[this.currentUser.Hh()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.cl[this.currentUser.Hh()]=n}},t.prototype.Il=function(t,e){var n=this;void 0===e&&(e=null),this.el.Ec(t);for(var r=0,i=this.rl.get(t);r<i.length;r++){var o=i[r];this.il.delete(o),e&&this.sl.bl(o,e)}this.rl.delete(t),this.dl&&this.ul.jh(t).forEach((function(t){n.ul.pi(t)||n.vl(t)}))},t.prototype.vl=function(t){var e=this.hl.get(t);null!==e&&(this.tl.pu(e),this.hl=this.hl.remove(t),this.al.delete(e),this.Pl())},t.prototype.El=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof zi?(this.ul.Ri(i.key,t),this.Sl(i)):i instanceof Qi?(l("SyncEngine","Document no longer in limbo: "+i.key),this.ul.gi(i.key,t),this.ul.pi(i.key)||this.vl(i.key)):v()}},t.prototype.Sl=function(t){var e=t.key;this.hl.get(e)||(l("SyncEngine","New document in limbo: "+e),this.ol.push(e),this.Pl())},t.prototype.Pl=function(){for(;this.ol.length>0&&this.hl.size<this.nl;){var t=this.ol.shift(),e=this._l.next();this.al.set(e,new Hi(t)),this.hl=this.hl.nt(t,e),this.tl.listen(new X(pn(hn(t.path)),e,2,Gn.ws))}},t.prototype.Dl=function(){return this.hl},t.prototype.Cl=function(){return this.ol},t.prototype.Al=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return n=[],r=[],o=[],this.il.forEach((function(i,u){o.push(Promise.resolve().then((function(){var e=u.view.Uc(t);return e.jc?s.tu.$h(u.query,!1).then((function(t){var n=t.documents;return u.view.Uc(n,e)})):e})).then((function(t){var i=e&&e.Wt.get(u.targetId),o=u.view.qn(t,s.dl,i);if(s.El(u.targetId,o.zc),o.snapshot){s.dl&&s.el.Ac(u.targetId,o.snapshot.fromCache?"not-current":"current"),n.push(o.snapshot);var a=Bn.cs(u.targetId,o.snapshot);r.push(a)}})))})),[4,Promise.all(o)];case 1:return i.sent(),this.sl.Ca(n),[4,this.tu.Ch(r)];case 2:return i.sent(),[2]}}))}))},t.prototype.wl=function(t){},t.prototype.Uu=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return this.currentUser.isEqual(t)?[3,3]:(l("SyncEngine","User change. New user:",t.Hh()),[4,this.tu.Ah(t)]);case 1:return e=n.sent(),this.currentUser=t,this.pl("'waitForPendingWrites' promise is rejected due to a user change."),this.el.Ah(t,e.Ph,e.gh),[4,this.Al(e.Rh)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.$e=function(t){var e=this.al.get(t);if(e&&e.Zc)return lt().add(e.key);var n=lt(),r=this.rl.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.il.get(s);n=n.Ct(u.view.Bc)}return n},t}();function Xi(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,(n=m(t)).tu.$h(e.query,!0)];case 1:return r=i.sent(),o=e.view.Jc(r),[2,(n.dl&&n.El(e.targetId,o.zc),o)]}}))}))}function $i(t,e,n,r){return i.__awaiter(this,void 0,void 0,(function(){var o,s;return i.__generator(this,(function(i){switch(i.label){case 0:return(o=m(t)).wl("applyBatchState()"),[4,function(t,e){var n=m(t),r=m(n.jn);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.Br(t,e).next((function(e){return e?n.Ih.Jn(t,e):Un.resolve(null)}))}))}(o.tu,e)];case 1:return null===(s=i.sent())?[3,6]:"pending"!==n?[3,3]:[4,o.tl.Pu()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(o.gl(e,r||null),function(t,e){m(m(t).jn).Gr(e)}(o.tu,e)):v(),i.label=4;case 4:return[4,o.Al(s)];case 5:return i.sent(),[3,7];case 6:l("SyncEngine","Cannot apply mutation batch with id: "+e),i.label=7;case 7:return[2]}}))}))}function Zi(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,u,a,c,h;return i.__generator(this,(function(i){switch(i.label){case 0:return n=m(t),!0!==e||!0===n.fl?[3,3]:(r=n.el.ac(),[4,Ji(n,r.F())]);case 1:return o=i.sent(),n.fl=!0,[4,n.tl.Wu(!0)];case 2:for(i.sent(),s=0,u=o;s<u.length;s++)a=u[s],n.tl.listen(a);return[3,7];case 3:return!1!==e||!1===n.fl?[3,7]:(c=[],h=Promise.resolve(),n.rl.forEach((function(t,e){n.el.Ic(e)?c.push(e):h=h.then((function(){return n.Il(e),n.tu.xh(e,!0)})),n.tl.pu(e)})),[4,h]);case 4:return i.sent(),[4,Ji(n,c)];case 5:return i.sent(),function(t){var e=m(t);e.al.forEach((function(t,n){e.tl.pu(n)})),e.ul.Kh(),e.al=new Map,e.hl=new tt(q.P)}(n),n.fl=!1,[4,n.tl.Wu(!1)];case 6:i.sent(),i.label=7;case 7:return[2]}}))}))}function Ji(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,u,a,c,h,f,l,p,d,y,v;return i.__generator(this,(function(i){switch(i.label){case 0:n=m(t),r=[],o=[],s=0,u=e,i.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=n.rl.get(a))&&0!==h.length?[4,n.tu.kh(pn(h[0]))]:[3,7]):[3,13];case 2:c=i.sent(),f=0,l=h,i.label=3;case 3:return f<l.length?(p=l[f],d=n.il.get(p),[4,Xi(n,d)]):[3,6];case 4:(y=i.sent()).snapshot&&o.push(y.snapshot),i.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,mi(n.tu,a)];case 8:return v=i.sent(),[4,n.tu.kh(v)];case 9:return c=i.sent(),[4,n.Tl(to(v),a,!1)];case 10:i.sent(),i.label=11;case 11:r.push(c),i.label=12;case 12:return s++,[3,1];case 13:return[2,(n.sl.Ca(o),r)]}}))}))}function to(t){return cn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function eo(t){var e=m(t);return m(m(e.tu).persistence).Ir()}function no(t,e,n,r){return i.__awaiter(this,void 0,void 0,(function(){var o,s,u;return i.__generator(this,(function(i){switch(i.label){case 0:return(o=m(t)).fl?(l("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.rl.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,function(t){var e=m(t),n=m(e.Eh);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n.Ks(t,e.Th)})).then((function(t){var n=t.Gs,r=t.readTime;return e.Th=r,n}))}(o.tu)];case 3:return s=i.sent(),u=mt.Gt(e,"current"===n),[4,o.Al(s,u)];case 4:return i.sent(),[3,8];case 5:return[4,o.tu.xh(e,!0)];case 6:return i.sent(),o.Il(e,r),[3,8];case 7:v(),i.label=8;case 8:return[2]}}))}))}function ro(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o,s,u,a,c,h,f,p,d;return i.__generator(this,(function(y){switch(y.label){case 0:if(!(r=m(t)).fl)return[3,10];o=0,s=e,y.label=1;case 1:return o<s.length?(u=s[o],r.rl.has(u)?(l("SyncEngine","Adding an already active target "+u),[3,5]):[4,mi(r.tu,u)]):[3,6];case 2:return a=y.sent(),[4,r.tu.kh(a)];case 3:return c=y.sent(),[4,r.Tl(to(a),c.targetId,!1)];case 4:y.sent(),r.tl.listen(c),y.label=5;case 5:return o++,[3,1];case 6:h=function(t){return i.__generator(this,(function(e){switch(e.label){case 0:return r.rl.has(t)?[4,r.tu.xh(t,!1).then((function(){r.tl.pu(t),r.Il(t)})).catch(wi)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,p=n,y.label=7;case 7:return f<p.length?(d=p[f],[5,h(d)]):[3,10];case 8:y.sent(),y.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}var io=function(){this.Fl=void 0,this.listeners=[]},oo=function(){function t(t){this.vu=t,this.Nl=new x((function(t){return mn(t)}),gn),this.onlineState="Unknown",this.kl=new Set,this.vu.subscribe(this)}return t.prototype.listen=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,u;return i.__generator(this,(function(i){switch(i.label){case 0:if(e=t.query,n=!1,(r=this.Nl.get(e))||(n=!0,r=new io),!n)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),o=r,[4,this.vu.listen(e)];case 2:return o.Fl=i.sent(),[3,4];case 3:return s=i.sent(),u=hi(s,"Initialization of query '"+wn(t.query)+"' failed"),[2,void t.onError(u)];case 4:return this.Nl.set(e,r),r.listeners.push(t),t.Hc(this.onlineState),r.Fl&&t.xl(r.Fl)&&this.$l(),[2]}}))}))},t.prototype.pu=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){return e=t.query,n=!1,(r=this.Nl.get(e))&&(o=r.listeners.indexOf(t))>=0&&(r.listeners.splice(o,1),n=0===r.listeners.length),n?[2,(this.Nl.delete(e),this.vu.pu(e))]:[2]}))}))},t.prototype.Ca=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.Nl.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].xl(i)&&(e=!0);s.Fl=i}}e&&this.$l()},t.prototype.bl=function(t,e){var n=this.Nl.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.Nl.delete(t)},t.prototype.Rl=function(t){this.onlineState=t;var e=!1;this.Nl.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].Hc(t)&&(e=!0)})),e&&this.$l()},t.prototype.Ml=function(t){this.kl.add(t),t.next()},t.prototype.Ol=function(t){this.kl.delete(t)},t.prototype.$l=function(){this.kl.forEach((function(t){t.next()}))},t}(),so=function(){function t(t,e,n){this.query=t,this.Ll=e,this.ql=!1,this.Bl=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.xl=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new gt(t.query,t.docs,t.Ot,e,t.Lt,t.fromCache,t.qt,!0)}var o=!1;return this.ql?this.Ul(t)&&(this.Ll.next(t),o=!0):this.Wl(t,this.onlineState)&&(this.Ql(t),o=!0),this.Bl=t,o},t.prototype.onError=function(t){this.Ll.error(t)},t.prototype.Hc=function(t){this.onlineState=t;var e=!1;return this.Bl&&!this.ql&&this.Wl(this.Bl,t)&&(this.Ql(this.Bl),e=!0),e},t.prototype.Wl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.jl&&n||t.docs._()&&"Offline"!==e)},t.prototype.Ul=function(t){if(t.docChanges.length>0)return!0;var e=this.Bl&&this.Bl.hasPendingWrites!==t.hasPendingWrites;return!(!t.qt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.Ql=function(t){t=gt.Ut(t.query,t.docs,t.Lt,t.fromCache),this.ql=!0,this.Ll.next(t)},t}(),uo=function(){function t(){}return t.prototype.mh=function(t){this.Kl=t},t.prototype.ts=function(t,e,n,r){var i=this;return e.on()||n.isEqual(O.min())?this.Gl(t,e):this.Kl.Jn(t,r).next((function(o){var u=i.zl(e,o);return(e.hn()||e.an())&&i.jc(e.en,u,r,n)?i.Gl(t,e):(f()<=s.LogLevel.DEBUG&&l("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),wn(e)),i.Kl.ts(t,e,n).next((function(t){return u.forEach((function(e){t=t.nt(e.key,e)})),t})))}))},t.prototype.zl=function(t,e){var n=new rt(_n(t));return e.forEach((function(e,r){r instanceof rn&&bn(t,r)&&(n=n.add(r))})),n},t.prototype.jc=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.o(r)>0)},t.prototype.Gl=function(t,e){return f()<=s.LogLevel.DEBUG&&l("IndexFreeQueryEngine","Using full collection scan to execute query:",wn(e)),this.Kl.ts(t,e,O.min())},t}(),ao=function(){function t(t,e){this.Kn=t,this.ii=e,this.jn=[],this.Hl=1,this.Yl=new rt(_i.Lh)}return t.prototype.Or=function(t){return Un.resolve(0===this.jn.length)},t.prototype.Lr=function(t,e,n,r){var i=this.Hl;this.Hl++,this.jn.length>0&&this.jn[this.jn.length-1];var o=new Vn(i,e,n,r);this.jn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Yl=this.Yl.add(new _i(a.key,i)),this.Kn.Cs(t,a.key.path.p())}return Un.resolve(o)},t.prototype.qr=function(t,e){return Un.resolve(this.Jl(e))},t.prototype.Ur=function(t,e){var n=e+1,r=this.Xl(n),i=r<0?0:r;return Un.resolve(this.jn.length>i?this.jn[i]:null)},t.prototype.Wr=function(){return Un.resolve(0===this.jn.length?-1:this.Hl-1)},t.prototype.Qr=function(t){return Un.resolve(this.jn.slice())},t.prototype.zn=function(t,e){var n=this,r=new _i(e,0),i=new _i(e,Number.POSITIVE_INFINITY),o=[];return this.Yl.vt([r,i],(function(t){var e=n.Jl(t.zh);o.push(e)})),Un.resolve(o)},t.prototype.Zn=function(t,e){var n=this,r=new rt(_);return e.forEach((function(t){var e=new _i(t,0),i=new _i(t,Number.POSITIVE_INFINITY);n.Yl.vt([e,i],(function(t){r=r.add(t.zh)}))})),Un.resolve(this.Zl(r))},t.prototype.os=function(t,e){var n=e.path,r=n.length+1,i=n;q.W(i)||(i=i.child(""));var o=new _i(new q(i),0),s=new rt(_);return this.Yl.St((function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.zh)),!0)}),o),Un.resolve(this.Zl(s))},t.prototype.Zl=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Jl(t);null!==r&&n.push(r)})),n},t.prototype.Kr=function(t,e){var n=this;g(0===this.t_(e.batchId,"removed")),this.jn.shift();var r=this.Yl;return Un.forEach(e.mutations,(function(i){var o=new _i(i.key,e.batchId);return r=r.delete(o),n.ii.Dr(t,i.key)})).next((function(){n.Yl=r}))},t.prototype.Gr=function(t){},t.prototype.pi=function(t,e){var n=new _i(e,0),r=this.Yl.Dt(n);return Un.resolve(e.isEqual(r&&r.key))},t.prototype.zr=function(t){return this.jn.length,Un.resolve()},t.prototype.t_=function(t,e){return this.Xl(t)},t.prototype.Xl=function(t){return 0===this.jn.length?0:t-this.jn[0].batchId},t.prototype.Jl=function(t){var e=this.Xl(t);return e<0||e>=this.jn.length?null:this.jn[e]},t}(),co=function(){function t(t,e){this.Kn=t,this.e_=e,this.docs=new tt(q.P),this.size=0}return t.prototype.kn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.e_(e);return this.docs=this.docs.nt(r,{Ls:e,size:s,readTime:n}),this.size+=s-o,this.Kn.Cs(t,r.path.p())},t.prototype.$n=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Mn=function(t,e){var n=this.docs.get(e);return Un.resolve(n?n.Ls:null)},t.prototype.getEntries=function(t,e){var n=this,r=ut();return e.forEach((function(t){var e=n.docs.get(t);r=r.nt(t,e?e.Ls:null)})),Un.resolve(r)},t.prototype.ts=function(t,e,n){for(var r=ct(),i=new q(e.path.child("")),o=this.docs.ut(i);o.wt();){var s=o.dt(),u=s.key,a=s.value,c=a.Ls,h=a.readTime;if(!e.path.D(u.path))break;h.o(n)<=0||c instanceof rn&&bn(e,c)&&(r=r.nt(c.key,c))}return Un.resolve(r)},t.prototype.n_=function(t,e){return Un.forEach(this.docs,(function(t){return e(t)}))},t.prototype.Hs=function(e){return new t.Ys(this)},t.prototype.Xs=function(t){return Un.resolve(this.size)},t}();co.Ys=function(t){function e(e){var n=this;return(n=t.call(this)||this).Zs=e,n}return i.__extends(e,t),e.prototype.qn=function(t){var e=this,n=[];return this.Cn.forEach((function(r,i){i?n.push(e.Zs.kn(t,i,e.readTime)):e.Zs.$n(r)})),Un.Sn(n)},e.prototype.On=function(t,e){return this.Zs.Mn(t,e)},e.prototype.Ln=function(t,e){return this.Zs.getEntries(t,e)},e}(qn);var ho=function(){function t(t){this.persistence=t,this.s_=new x((function(t){return z(t)}),Q),this.lastRemoteSnapshotVersion=O.min(),this.highestTargetId=0,this.i_=0,this.r_=new bi,this.targetCount=0,this.o_=yr.ni()}return t.prototype.pe=function(t,e){return this.s_.forEach((function(t,n){return e(n)})),Un.resolve()},t.prototype.ai=function(t){return Un.resolve(this.lastRemoteSnapshotVersion)},t.prototype.ui=function(t){return Un.resolve(this.i_)},t.prototype.ri=function(t){return this.highestTargetId=this.o_.next(),Un.resolve(this.highestTargetId)},t.prototype.ci=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.i_&&(this.i_=e),Un.resolve()},t.prototype._i=function(t){this.s_.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.o_=new yr(e),this.highestTargetId=e),t.sequenceNumber>this.i_&&(this.i_=t.sequenceNumber)},t.prototype.li=function(t,e){return this._i(e),this.targetCount+=1,Un.resolve()},t.prototype.di=function(t,e){return this._i(e),Un.resolve()},t.prototype.wi=function(t,e){return this.s_.delete(e.target),this.r_.jh(e.targetId),this.targetCount-=1,Un.resolve()},t.prototype.Ei=function(t,e,n){var r=this,i=0,o=[];return this.s_.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.s_.delete(s),o.push(r.Ti(t,u.targetId)),i++)})),Un.Sn(o).next((function(){return i}))},t.prototype.Ii=function(t){return Un.resolve(this.targetCount)},t.prototype.mi=function(t,e){var n=this.s_.get(e)||null;return Un.resolve(n)},t.prototype.Ai=function(t,e,n){return this.r_.Uh(e,n),Un.resolve()},t.prototype.Pi=function(t,e,n){this.r_.Qh(e,n);var r=this.persistence.ii,i=[];return r&&e.forEach((function(e){i.push(r.Dr(t,e))})),Un.Sn(i)},t.prototype.Ti=function(t,e){return this.r_.jh(e),Un.resolve()},t.prototype.Vi=function(t,e){var n=this.r_.Gh(e);return Un.resolve(n)},t.prototype.pi=function(t,e){return Un.resolve(this.r_.pi(e))},t}(),fo=function(){function t(t){var e=this;this.h_={},this.Ci=new Gn(0),this.Fi=!1,this.Fi=!0,this.ii=t(this),this.qi=new ho(this),this.Kn=new Xn,this.Qn=new co(this.Kn,(function(t){return e.ii.a_(t)}))}return t.prototype.start=function(){return Promise.resolve()},t.prototype._r=function(){return this.Fi=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Hi",{get:function(){return this.Fi},enumerable:!1,configurable:!0}),t.prototype.Yi=function(){},t.prototype.Xi=function(){},t.prototype.gr=function(){return this.Kn},t.prototype.mr=function(t){var e=this.h_[t.Hh()];return e||(e=new ao(this.Kn,this.ii),this.h_[t.Hh()]=e),e},t.prototype.Rr=function(){return this.qi},t.prototype.Pr=function(){return this.Qn},t.prototype.runTransaction=function(t,e,n){var r=this;l("MemoryPersistence","Starting transaction:",t);var i=new lo(this.Ci.next());return this.ii.u_(),n(i).next((function(t){return r.ii.c_(i).next((function(){return t}))})).bn().then((function(t){return i.Wn(),t}))},t.prototype.l_=function(t,e){return Un.Dn(Object.values(this.h_).map((function(n){return function(){return n.pi(t,e)}})))},t}(),lo=function(t){function e(e){var n=this;return(n=t.call(this)||this).vi=e,n}return i.__extends(e,t),e}(Fn),po=function(){function t(t){this.persistence=t,this.__=new bi,this.f_=null}return t.d_=function(e){return new t(e)},Object.defineProperty(t.prototype,"w_",{get:function(){if(this.f_)return this.f_;throw v()},enumerable:!1,configurable:!0}),t.prototype.Ri=function(t,e,n){return this.__.Ri(n,e),this.w_.delete(n),Un.resolve()},t.prototype.gi=function(t,e,n){return this.__.gi(n,e),this.w_.add(n),Un.resolve()},t.prototype.Dr=function(t,e){return this.w_.add(e),Un.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.__.jh(e.targetId).forEach((function(t){return n.w_.add(t)}));var r=this.persistence.Rr();return r.Vi(t,e.targetId).next((function(t){t.forEach((function(t){return n.w_.add(t)}))})).next((function(){return r.wi(t,e)}))},t.prototype.u_=function(){this.f_=new Set},t.prototype.c_=function(t){var e=this,n=this.persistence.Pr().Hs();return Un.forEach(this.w_,(function(r){return e.T_(t,r).next((function(t){t||n.$n(r)}))})).next((function(){return e.f_=null,n.apply(t)}))},t.prototype.kr=function(t,e){var n=this;return this.T_(t,e).next((function(t){t?n.w_.delete(e):n.w_.add(e)}))},t.prototype.a_=function(t){return 0},t.prototype.T_=function(t,e){var n=this;return Un.Dn([function(){return Un.resolve(n.__.pi(e))},function(){return n.persistence.Rr().pi(t,e)},function(){return n.persistence.l_(t,e)}])},t}(),yo=function(){function t(t){this.E_=t.E_,this.I_=t.I_}return t.prototype.Sa=function(t){this.m_=t},t.prototype.Va=function(t){this.A_=t},t.prototype.onMessage=function(t){this.R_=t},t.prototype.close=function(){this.I_()},t.prototype.send=function(t){this.E_(t)},t.prototype.P_=function(){this.m_()},t.prototype.g_=function(t){this.A_(t)},t.prototype.V_=function(t){this.R_(t)},t}(),vo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},go=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n}return i.__extends(e,t),e.prototype.D_=function(t,e,n,r){return new Promise((function(i,o){var s=new a.XhrIo;s.listenOnce(a.EventType.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case a.ErrorCode.NO_ERROR:var e=s.getResponseJson();l("Connection","XHR received:",JSON.stringify(e)),i(e);break;case a.ErrorCode.TIMEOUT:l("Connection",'RPC "'+t+'" timed out'),o(new P(S.DEADLINE_EXCEEDED,"Request time out"));break;case a.ErrorCode.HTTP_ERROR:var n=s.getStatus();if(l("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var u=function(t){var e=t.toLowerCase().replace("_","-");return Object.values(S).indexOf(e)>=0?e:S.UNKNOWN}(r.status);o(new P(u,r.message))}else o(new P(S.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new P(S.UNAVAILABLE,"Connection failed."));break;default:v()}}finally{l("Connection",'RPC "'+t+'" completed.')}}));var u=JSON.stringify(r);s.send(e,"POST",u,n,15)}))},e.prototype.Da=function(t,e){var n=[this.p_,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=a.createWebChannelTransport(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.S_(i.initMessageHeaders,e),u.isMobileCordova()||u.isReactNative()||u.isElectron()||u.isIE()||u.isUWP()||u.isBrowserExtension()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");l("Connection","Creating WebChannel: "+o,i);var s=r.createWebChannel(o,i),c=!1,h=!1,f=new yo({E_:function(t){h?l("Connection","Not sending because WebChannel is closed:",t):(c||(l("Connection","Opening WebChannel transport."),s.open(),c=!0),l("Connection","WebChannel sending:",t),s.send(t))},I_:function(){return s.close()}}),p=function(t,e){s.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return p(a.WebChannel.EventType.OPEN,(function(){h||l("Connection","WebChannel transport opened.")})),p(a.WebChannel.EventType.CLOSE,(function(){h||(h=!0,l("Connection","WebChannel transport closed"),f.g_())})),p(a.WebChannel.EventType.ERROR,(function(t){h||(h=!0,d("Connection","WebChannel transport errored:",t),f.g_(new P(S.UNAVAILABLE,"The operation could not be completed")))})),p(a.WebChannel.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];g(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){l("Connection","WebChannel received error:",i);var o=i.status,u=function(t){var e=H[t];if(void 0!==e)return J(e)}(o),a=i.message;void 0===u&&(u=S.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,f.g_(new P(u,a)),s.close()}else l("Connection","WebChannel received:",n),f.V_(n)}})),setTimeout((function(){f.P_()}),0),f},e}(function(){function t(t){this.y_=t,this.s=t.s;var e=t.ssl?"https":"http";this.p_=e+"://"+t.host,this.b_="projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents"}return t.prototype.Ua=function(t,e,n,r){var i=this.v_(t,e);l("RestConnection","Sending: ",i,n);var o={};return this.S_(o,r),this.D_(t,i,o,n).then((function(t){return l("RestConnection","Received: ",t),t}),(function(e){throw d("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Wa=function(t,e,n,r){return this.Ua(t,e,n,r)},t.prototype.S_=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.17.2",t["Content-Type"]="text/plain",e)for(var n in e.Xh)e.Xh.hasOwnProperty(n)&&(t[n]=e.Xh[n])},t.prototype.v_=function(t,e){var n=vo[t];return this.p_+"/v1/"+e+":"+n},t}()),mo=function(){function t(){var t=this;this.C_=function(){return t.F_()},this.N_=function(){return t.k_()},this.x_=[],this.M_()}return t.prototype.hu=function(t){this.x_.push(t)},t.prototype._r=function(){window.removeEventListener("online",this.C_),window.removeEventListener("offline",this.N_)},t.prototype.M_=function(){window.addEventListener("online",this.C_),window.addEventListener("offline",this.N_)},t.prototype.F_=function(){l("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.x_;t<e.length;t++)(0,e[t])(0)},t.prototype.k_=function(){l("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.x_;t<e.length;t++)(0,e[t])(1)},t.Oi=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),wo=function(){function t(){}return t.prototype.hu=function(t){},t.prototype._r=function(){},t}();function bo(t){return new Wt(t,!0)}var _o="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Io=function(){function t(){}return t.prototype.initialize=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return this.el=this.O_(t),this.persistence=this.L_(t),[4,this.persistence.start()];case 1:return e.sent(),this.q_=this.B_(t),this.tu=this.U_(t),[2]}}))}))},t.prototype.B_=function(t){return null},t.prototype.U_=function(t){return e=this.persistence,n=new uo,r=t.W_,new gi(e,n,r);var e,n,r},t.prototype.L_=function(t){if(t.j_.Q_)throw new P(S.FAILED_PRECONDITION,_o);return new fo(po.d_)},t.prototype.O_=function(t){return new Gi},t.prototype.terminate=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.q_&&this.q_.stop(),[4,this.el._r()];case 1:return t.sent(),[4,this.persistence._r()];case 2:return t.sent(),[2]}}))}))},t.prototype.clearPersistence=function(t,e){throw new P(S.FAILED_PRECONDITION,_o)},t}(),Eo=function(t){function e(e){var n=this;return(n=t.call(this)||this).K_=e,n}return i.__extends(e,t),e.prototype.initialize=function(e){return i.__awaiter(this,void 0,void 0,(function(){var n,r=this;return i.__generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),[4,this.K_.initialize(this,e)];case 2:return o.sent(),n=this.K_.vu,this.el instanceof Bi?(this.el.vu={Cc:$i.bind(null,n),Fc:no.bind(null,n),Nc:ro.bind(null,n),Ir:eo.bind(null,n)},[4,this.el.start()]):[3,4];case 3:o.sent(),o.label=4;case 4:return[4,this.persistence.zi((function(t){return i.__awaiter(r,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return[4,Zi(this.K_.vu,t)];case 1:return e.sent(),this.q_&&(t&&!this.q_.Hi?this.q_.start(this.tu):t||this.q_.stop()),[2]}}))}))}))];case 5:return o.sent(),[2]}}))}))},e.prototype.O_=function(t){if(t.j_.Q_&&t.j_.synchronizeTabs){var e=ui();if(!Bi.Oi(e))throw new P(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=kr(t.y_.s,t.y_.persistenceKey);return new Bi(e,t.ao,n,t.clientId,t.W_)}return new Gi},e}(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.initialize=function(e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n;return i.__generator(this,(function(r){return e=m(t),n=m(e.Eh),[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return n.zs(t)})).then((function(t){e.Th=t}))]}))}))}(this.tu)];case 2:return n.sent(),[2]}}))}))},e.prototype.B_=function(t){var e=this.persistence.ii.yr;return new yi(e,t.ao)},e.prototype.L_=function(t){var e=kr(t.y_.s,t.y_.persistenceKey),n=bo(t.y_.s);return new Ir(t.j_.synchronizeTabs,e,t.clientId,di.Ho(t.j_.cacheSizeBytes),t.ao,ui(),"undefined"!=typeof document?document:null,n,this.el,t.j_.Di)},e.prototype.O_=function(t){return new Gi},e.prototype.clearPersistence=function(t,e){return function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return Zr.Oi()?(e=t+"main",[4,Zr.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(kr(t,e))},e}(Io)),To=function(){function t(){}return t.prototype.initialize=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.tu?[2]:(this.tu=t.tu,this.el=t.el,this.eu=this.G_(e),[4,this.z_(e)]);case 1:return n=i.sent(),this.eu.start(n),this.tl=this.H_(e),this.vu=this.Y_(e),this.J_=this.X_(e),this.el.ja=function(t){return r.vu.Hc(t,1)},this.tl.vu=this.vu,[4,this.tl.start()];case 2:return i.sent(),[4,this.tl.Wu(this.vu.dl)];case 3:return i.sent(),[2]}}))}))},t.prototype.z_=function(t){return e=t.y_,Promise.resolve(new go(e));var e},t.prototype.X_=function(t){return new oo(this.vu)},t.prototype.G_=function(t){var e=bo(t.y_.s);return function(t,e){return new Pi(t,e)}(t.credentials,e)},t.prototype.H_=function(t){var e=this;return new Oi(this.tu,this.eu,t.ao,(function(t){return e.vu.Hc(t,0)}),mo.Oi()?new mo:new wo)},t.prototype.Y_=function(t){return function(t,e,n,r,i,o,s){var u=new Yi(t,e,n,r,i,o);return s&&(u.fl=!0),u}(this.tu,this.tl,this.eu,this.el,t.W_,t.nl,!t.j_.Q_||!t.j_.synchronizeTabs)},t.prototype.terminate=function(){return this.tl._r()},t}();function No(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Ao=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.Z_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.Z_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.tf=function(){this.muted=!0},t.prototype.Z_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();function ko(t,e){if(0!==e.length)throw new P(S.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Qo(e.length,"argument")+".")}function Do(t,e,n){if(e.length!==n)throw new P(S.INVALID_ARGUMENT,"Function "+t+"() requires "+Qo(n,"argument")+", but was called with "+Qo(e.length,"argument")+".")}function xo(t,e,n){if(e.length<n)throw new P(S.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Qo(n,"argument")+", but was called with "+Qo(e.length,"argument")+".")}function So(t,e,n,r){if(e.length<n||e.length>r)throw new P(S.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Qo(e.length,"argument")+".")}function Po(t,e,n,r){Uo(t,e,zo(n)+" argument",r)}function Lo(t,e,n,r){void 0!==r&&Po(t,e,n,r)}function Oo(t,e,n,r){Uo(t,e,n+" option",r)}function Ro(t,e,n,r){void 0!==r&&Oo(t,e,n,r)}function Vo(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,u=i;s<u.length;s++){var a=u[s];if(a===r)return;o.push(Mo(a))}var c=Mo(r);throw new P(S.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Co(t,e,n,r){if(!e.some((function(t){return t===r})))throw new P(S.INVALID_ARGUMENT,"Invalid value "+Mo(r)+" provided to function "+t+"() for its "+zo(n)+" argument. Acceptable values: "+e.join(", "));return r}function Uo(t,e,n,r){if(!("object"===e?qo(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Mo(r);throw new P(S.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function qo(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Mo(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":v()}function Fo(t,e,n){if(void 0===n)throw new P(S.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+zo(e)+" argument, but it was undefined.")}function jo(t,e,n){k(e,(function(e,r){if(n.indexOf(e)<0)throw new P(S.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function Bo(t,e,n,r){var i=Mo(r);return new P(S.INVALID_ARGUMENT,"Function "+t+"() requires its "+zo(n)+" argument to be a "+e+", but it was: "+i)}function Go(t,e,n){if(n<=0)throw new P(S.INVALID_ARGUMENT,"Function "+t+"() requires its "+zo(e)+" argument to be a positive number, but it was: "+n+".")}function zo(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Qo(t,e){return t+" "+e+(1===t?"":"s")}function Ko(){if("undefined"==typeof Uint8Array)throw new P(S.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Wo(){if("undefined"==typeof atob)throw new P(S.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ho=function(){function t(t){Wo(),this.ef=t}return t.fromBase64String=function(e){Do("Blob.fromBase64String",arguments,1),Po("Blob.fromBase64String","string",1,e),Wo();try{return new t(W.fromBase64String(e))}catch(e){throw new P(S.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}},t.fromUint8Array=function(e){if(Do("Blob.fromUint8Array",arguments,1),Ko(),!(e instanceof Uint8Array))throw Bo("Blob.fromUint8Array","Uint8Array",1,e);return new t(W.fromUint8Array(e))},t.prototype.toBase64=function(){return Do("Blob.toBase64",arguments,0),Wo(),this.ef.toBase64()},t.prototype.toUint8Array=function(){return Do("Blob.toUint8Array",arguments,0),Ko(),this.ef.toUint8Array()},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.ef.isEqual(t.ef)},t}(),Yo=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new P(S.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Qo(1,"element")+".")}(0,t);for(var e=0;e<t.length;++e)if(Po("FieldPath","string",e,t[e]),0===t[e].length)throw new P(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.nf=new U(t)},Xo=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return i.__extends(e,t),e.documentId=function(){return new e(U.L().N())},e.prototype.isEqual=function(t){if(!(t instanceof e))throw Bo("isEqual","FieldPath",1,t);return this.nf.isEqual(t.nf)},e}(Yo),$o=new RegExp("[~\\*/\\[\\]]"),Zo=function(){this.sf=this},Jo=function(t){function e(e){var n=this;return(n=t.call(this)||this).if=e,n}return i.__extends(e,t),e.prototype.rf=function(t){if(2!==t.hf)throw 1===t.hf?t.af(this.if+"() can only appear at the top level of your update data"):t.af(this.if+"() cannot be used with set() unless you pass {merge:true}");return t.Le.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Zo);function ts(t,e,n){return new ps({hf:3,uf:e.settings.uf,methodName:t.if,cf:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var es=function(t){function e(e){var n=this;return(n=t.call(this)||this).if=e,n}return i.__extends(e,t),e.prototype.rf=function(t){return new Ve(t.path,new Ae)},e.prototype.isEqual=function(t){return t instanceof e},e}(Zo),ns=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).if=e,r.lf=n,r}return i.__extends(e,t),e.prototype.rf=function(t){var e=ts(this,t,!0),n=this.lf.map((function(t){return ws(t,e)})),r=new ke(n);return new Ve(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Zo),rs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).if=e,r.lf=n,r}return i.__extends(e,t),e.prototype.rf=function(t){var e=ts(this,t,!0),n=this.lf.map((function(t){return ws(t,e)})),r=new xe(n);return new Ve(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Zo),is=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).if=e,r._f=n,r}return i.__extends(e,t),e.prototype.rf=function(t){var e=new Pe(t.serializer,Xt(t.serializer,this._f));return new Ve(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Zo),os=function(t){function e(){return t.call(this)||this}return i.__extends(e,t),e.delete=function(){return ko("FieldValue.delete",arguments),new ss(new Jo("FieldValue.delete"))},e.serverTimestamp=function(){return ko("FieldValue.serverTimestamp",arguments),new ss(new es("FieldValue.serverTimestamp"))},e.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xo("FieldValue.arrayUnion",arguments,1),new ss(new ns("FieldValue.arrayUnion",t))},e.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xo("FieldValue.arrayRemove",arguments,1),new ss(new rs("FieldValue.arrayRemove",t))},e.increment=function(t){return Po("FieldValue.increment","number",1,t),Do("FieldValue.increment",arguments,1),new ss(new is("FieldValue.increment",t))},e}(Zo),ss=function(t){function e(e){var n=this;return(n=t.call(this)||this).sf=e,n.if=e.if,n}return i.__extends(e,t),e.prototype.rf=function(t){return this.sf.rf(t)},e.prototype.isEqual=function(t){return t instanceof e&&this.sf.isEqual(t.sf)},e}(os),us=function(){function t(t,e){if(Do("GeoPoint",arguments,2),Po("GeoPoint","number",1,t),Po("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new P(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new P(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.ff=t,this.df=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.ff},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.df},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.ff===t.ff&&this.df===t.df},t.prototype.T=function(t){return _(this.ff,t.ff)||_(this.df,t.df)},t}(),as=/^__.*__$/,cs=function(t,e,n){this.wf=t,this.Tf=e,this.Ef=n},hs=function(){function t(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}return t.prototype.If=function(t,e){var n=[];return null!==this.Le?n.push(new Ke(t,this.data,this.Le,e)):n.push(new Qe(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new He(t,this.fieldTransforms)),n},t}(),fs=function(){function t(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}return t.prototype.If=function(t,e){var n=[new Ke(t,this.data,this.Le,e)];return this.fieldTransforms.length>0&&n.push(new He(t,this.fieldTransforms)),n},t}();function ls(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v()}}var ps=function(){function t(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.mf(),this.fieldTransforms=i||[],this.Le=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hf",{get:function(){return this.settings.hf},enumerable:!1,configurable:!0}),t.prototype.Af=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Le)},t.prototype.Rf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Af({path:n,cf:!1});return r.Pf(t),r},t.prototype.gf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Af({path:n,cf:!1});return r.mf(),r},t.prototype.Vf=function(t){return this.Af({path:void 0,cf:!0})},t.prototype.af=function(t){return Ns(t,this.settings.methodName,this.settings.yf||!1,this.path,this.settings.uf)},t.prototype.contains=function(t){return void 0!==this.Le.find((function(e){return t.D(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.D(e.field)}))},t.prototype.mf=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Pf(this.path.get(t))},t.prototype.Pf=function(t){if(0===t.length)throw this.af("Document fields must not be empty");if(ls(this.hf)&&as.test(t))throw this.af('Document fields cannot begin and end with "__"')},t}(),ds=function(){function t(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||bo(t)}return t.prototype.pf=function(t,e,n,r){return void 0===r&&(r=!1),new ps({hf:t,methodName:e,uf:n,path:U.$(),cf:!1,yf:r},this.s,this.serializer,this.ignoreUndefinedProperties)},t}();function ys(t,e,n,r,i,o){void 0===o&&(o={});var s=t.pf(o.merge||o.mergeFields?2:0,e,n,i);Is("Data must be an object, but it was:",s,r);var u,a,c=bs(r,s);if(o.merge)u=new Re(s.Le),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Yo)d=p.nf;else{if("string"!=typeof p)throw v();d=Ts(e,p,n)}if(!s.contains(d))throw new P(S.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");As(h,d)||h.push(d)}u=new Re(h),a=s.fieldTransforms.filter((function(t){return u.je(t.field)}))}else u=null,a=s.fieldTransforms;return new hs(new Je(c),u,a)}function vs(t,e,n,r){var i=t.pf(1,e,n);Is("Data must be an object, but it was:",i,r);var o=[],s=new tn;k(r,(function(t,r){var u=Ts(e,t,n),a=i.gf(u);if(r instanceof Zo&&r.sf instanceof Jo)o.push(u);else{var c=ws(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new Re(o);return new fs(s.Ge(),u,i.fieldTransforms)}function gs(t,e,n,r,i,o){var s=t.pf(1,e,n),u=[Es(e,r,n)],a=[i];if(o.length%2!=0)throw new P(S.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Es(e,o[c])),a.push(o[c+1]);for(var h=[],f=new tn,l=u.length-1;l>=0;--l)if(!As(h,u[l])){var p=u[l],d=a[l],y=s.gf(p);if(d instanceof Zo&&d.sf instanceof Jo)h.push(p);else{var v=ws(d,y);null!=v&&(h.push(p),f.set(p,v))}}var g=new Re(h);return new fs(f.Ge(),g,s.fieldTransforms)}function ms(t,e,n,r){return void 0===r&&(r=!1),ws(n,t.pf(r?4:3,e))}function ws(t,e){if(_s(t))return Is("Unsupported field value:",e,t),bs(t,e);if(t instanceof Zo)return function(t,e){if(!ls(e.hf))throw e.af(t.if+"() can only be used with update() and set()");if(!e.path)throw e.af(t.if+"() is not currently supported inside arrays");var n=t.rf(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Le.push(e.path),t instanceof Array){if(e.settings.cf&&4!==e.hf)throw e.af("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=ws(o[i],e.Vf(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Xt(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=L.fromDate(t);return{timestampValue:$t(e.serializer,n)}}if(t instanceof L){var r=new L(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:$t(e.serializer,r)}}if(t instanceof us)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ho)return{bytesValue:Zt(e.serializer,t)};if(t instanceof cs){var i=e.s,o=t.wf;if(!o.isEqual(i))throw e.af("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:ee(t.wf||e.s,t.Tf.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.af("Unsupported field value: "+Mo(t))}(t,e)}function bs(t,e){var n={};return D(t)?e.path&&e.path.length>0&&e.Le.push(e.path):k(t,(function(t,r){var i=ws(r,e.Rf(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function _s(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof L||t instanceof us||t instanceof Ho||t instanceof cs||t instanceof Zo)}function Is(t,e,n){if(!_s(n)||!qo(n)){var r=Mo(n);throw"an object"===r?e.af(t+" a custom object"):e.af(t+" "+r)}}function Es(t,e,n){if(e instanceof Yo)return e.nf;if("string"==typeof e)return Ts(t,e);throw Ns("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Ts(t,e,n){try{return function(t){if(t.search($o)>=0)throw new P(S.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Xo.bind.apply(Xo,i.__spreadArrays([void 0],t.split("."))))}catch(i){throw new P(S.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).nf}catch(e){throw Ns((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n)}var r}function Ns(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new P(S.INVALID_ARGUMENT,(u+=". ")+t+a)}function As(t,e){return t.some((function(t){return t.isEqual(e)}))}var ks=function(){function t(t){this.eu=t,this.bf=new Map,this.mutations=[],this.vf=!1,this.Sf=null,this.Df=new Set}return t.prototype.Cf=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:if(this.Ff(),this.mutations.length>0)throw new P(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,u,a;return i.__generator(this,(function(i){switch(i.label){case 0:return n=m(t),r=ue(n.serializer)+"/documents",o={documents:e.map((function(t){return re(n.serializer,t)}))},[4,n.Wa("BatchGetDocuments",r,o)];case 1:return s=i.sent(),u=new Map,s.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){g(!!e.found),e.found.name,e.found.updateTime;var n=ie(t,e.found.name),r=te(e.found.updateTime),i=new Je({mapValue:{fields:e.found.fields}});return new rn(n,r,i,{})}(t,e):"missing"in e?function(t,e){g(!!e.missing),g(!!e.readTime);var n=ie(t,e.missing),r=te(e.readTime);return new on(n,r)}(t,e):v()}(n.serializer,t);u.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=u.get(t.toString());g(!!e),a.push(e)})),a)]}}))}))}(this.eu,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof on||t instanceof rn?n.Nf(t):v()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.If(t,this.Ue(t))),this.Df.add(t)},t.prototype.update=function(t,e){try{this.write(e.If(t,this.kf(t)))}catch(t){this.Sf=t}this.Df.add(t)},t.prototype.delete=function(t){this.write([new $e(t,this.Ue(t))]),this.Df.add(t)},t.prototype.commit=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){switch(n.label){case 0:if(this.Ff(),this.Sf)throw this.Sf;return t=this.bf,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=new q(V.k(n));e.mutations.push(new Ze(r,e.Ue(r)))})),[4,function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:return n=m(t),r=ue(n.serializer)+"/documents",o={writes:e.map((function(t){return he(n.serializer,t)}))},[4,n.Ua("Commit",r,o)];case 1:return i.sent(),[2]}}))}))}(this.eu,this.mutations)];case 1:return n.sent(),this.vf=!0,[2]}}))}))},t.prototype.Nf=function(t){var e;if(t instanceof rn)e=t.version;else{if(!(t instanceof on))throw v();e=O.min()}var n=this.bf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new P(S.ABORTED,"Document version changed between two reads.")}else this.bf.set(t.key.toString(),e)},t.prototype.Ue=function(t){var e=this.bf.get(t.toString());return!this.Df.has(t)&&e?Ue.updateTime(e):Ue.We()},t.prototype.kf=function(t){var e=this.bf.get(t.toString());if(!this.Df.has(t)&&e){if(e.isEqual(O.min()))throw new P(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ue.updateTime(e)}return Ue.exists(!0)},t.prototype.write=function(t){this.Ff(),this.mutations=this.mutations.concat(t)},t.prototype.Ff=function(){},t}(),Ds=function(){function t(t,e,n,r){this.ao=t,this.eu=e,this.updateFunction=n,this.lo=r,this.xf=5,this.Po=new Qn(this.ao,"transaction_retry")}return t.prototype.run=function(){this.$f()},t.prototype.$f=function(){var t=this;this.Po.ys((function(){return i.__awaiter(t,void 0,void 0,(function(){var t,e,n=this;return i.__generator(this,(function(r){return t=new ks(this.eu),(e=this.Mf(t))&&e.then((function(e){n.ao.Zi((function(){return t.commit().then((function(){n.lo.resolve(e)})).catch((function(t){n.Of(t)}))}))})).catch((function(t){n.Of(t)})),[2]}))}))}))},t.prototype.Mf=function(t){try{var e=this.updateFunction(t);return!M(e)&&e.catch&&e.then?e:(this.lo.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.lo.reject(t),null}},t.prototype.Of=function(t){var e=this;this.xf>0&&this.Lf(t)?(this.xf-=1,this.ao.Zi((function(){return e.$f(),Promise.resolve()}))):this.lo.reject(t)},t.prototype.Lf=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Z(e)}return!1},t}(),xs=function(){function t(t,e){this.credentials=t,this.ao=e,this.clientId=b.t(),this.qf=new zn}return t.prototype.start=function(t,e,n,r){var i=this;this.Bf(),this.y_=t;var o=new zn,s=!1;return this.credentials.ea((function(t){if(!s)return s=!0,l("FirestoreClient","Initializing. user=",t.uid),i.Uf(e,n,r,t,o).then(i.qf.resolve,i.qf.reject);i.ao.er((function(){return i.tl.Uu(t)}))})),this.ao.Zi((function(){return i.qf.promise})),o.promise},t.prototype.enableNetwork=function(){var t=this;return this.Bf(),this.ao.enqueue((function(){return t.persistence.Xi(!0),t.tl.enableNetwork()}))},t.prototype.Uf=function(t,e,n,r,o){return i.__awaiter(this,void 0,void 0,(function(){var s,u,a=this;return i.__generator(this,(function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),s={ao:this.ao,y_:this.y_,clientId:this.clientId,credentials:this.credentials,W_:r,nl:100,j_:n},[4,t.initialize(s)];case 1:return c.sent(),[4,e.initialize(t,s)];case 2:return c.sent(),this.persistence=t.persistence,this.el=t.el,this.tu=t.tu,this.q_=t.q_,this.eu=e.eu,this.tl=e.tl,this.vu=e.vu,this.Wf=e.J_,this.persistence.Yi((function(){return i.__awaiter(a,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),o.resolve(),[3,4];case 3:if(u=c.sent(),o.reject(u),!this.Qf(u))throw u;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+u),this.Uf(new Io,new To,{Q_:!1},r,o))];case 4:return[2]}}))}))},t.prototype.Qf=function(t){return"FirebaseError"===t.name?t.code===S.FAILED_PRECONDITION||t.code===S.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.Bf=function(){if(this.ao.yo)throw new P(S.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.disableNetwork=function(){var t=this;return this.Bf(),this.ao.enqueue((function(){return t.persistence.Xi(!1),t.tl.disableNetwork()}))},t.prototype.terminate=function(){var t=this;return this.ao.Do((function(){return i.__awaiter(t,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.q_&&this.q_.stop(),[4,this.tl._r()];case 1:return t.sent(),[4,this.el._r()];case 2:return t.sent(),[4,this.persistence._r()];case 3:return t.sent(),this.credentials.na(),[2]}}))}))}))},t.prototype.waitForPendingWrites=function(){var t=this;this.Bf();var e=new zn;return this.ao.Zi((function(){return t.vu.yl(e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.Bf();var i=new Ao(n),o=new so(t,i,e);return this.ao.Zi((function(){return r.Wf.listen(o)})),function(){i.tf(),r.ao.Zi((function(){return r.Wf.pu(o)}))}},t.prototype.jf=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return this.Bf(),[4,this.qf.promise];case 1:return[2,(e.sent(),function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o=this;return i.__generator(this,(function(s){switch(s.label){case 0:return r=new zn,[4,t.enqueue((function(){return i.__awaiter(o,void 0,void 0,(function(){var t,o,s;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e.Nh(n)];case 1:return(t=i.sent())instanceof rn?r.resolve(t):t instanceof on?r.resolve(null):r.reject(new P(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return o=i.sent(),s=hi(o,"Failed to get document '"+n+" from cache"),r.reject(s),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(s.sent(),r.promise)]}}))}))}(this.ao,this.tu,t))]}}))}))},t.prototype.Kf=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(n){switch(n.label){case 0:return this.Bf(),[4,this.qf.promise];case 1:return[2,(n.sent(),function(t,e,n,r){var i=new zn,o=Ss(t,e,hn(n.path),{includeMetadataChanges:!0,jl:!0},{next:function(t){o();var e=t.docs.has(n);!e&&t.fromCache?i.reject(new P(S.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&r&&"server"===r.source?i.reject(new P(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(t)},error:function(t){return i.reject(t)}});return i.promise}(this.ao,this.Wf,t,e))]}}))}))},t.prototype.Gf=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return this.Bf(),[4,this.qf.promise];case 1:return[2,(e.sent(),function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o=this;return i.__generator(this,(function(s){switch(s.label){case 0:return r=new zn,[4,t.enqueue((function(){return i.__awaiter(o,void 0,void 0,(function(){var t,o,s,u,a,c;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e.$h(n,!0)];case 1:return t=i.sent(),o=new Ki(n,t.Mh),s=o.Uc(t.documents),u=o.qn(s,!1),r.resolve(u.snapshot),[3,3];case 2:return a=i.sent(),c=hi(a,"Failed to execute query '"+n+" against cache"),r.reject(c),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(s.sent(),r.promise)]}}))}))}(this.ao,this.tu,t))]}}))}))},t.prototype.zf=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(n){switch(n.label){case 0:return this.Bf(),[4,this.qf.promise];case 1:return[2,(n.sent(),function(t,e,n,r){var i=new zn,o=Ss(t,e,n,{includeMetadataChanges:!0,jl:!0},{next:function(t){o(),t.fromCache&&r&&"server"===r.source?i.reject(new P(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}});return i.promise}(this.ao,this.Wf,t,e))]}}))}))},t.prototype.write=function(t){var e=this;this.Bf();var n=new zn;return this.ao.Zi((function(){return e.vu.write(t,n)})),n.promise},t.prototype.s=function(){return this.y_.s},t.prototype.Ml=function(t){var e=this;this.Bf();var n=new Ao(t);return this.ao.Zi((function(){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(t){return[2,this.Wf.Ml(n)]}))}))})),function(){n.tf(),e.ao.Zi((function(){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(t){return[2,this.Wf.Ol(n)]}))}))}))}},Object.defineProperty(t.prototype,"Hf",{get:function(){return this.ao.yo},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.Bf();var n=new zn;return this.ao.Zi((function(){return new Ds(e.ao,e.eu,t,n).run(),Promise.resolve()})),n.promise},t}();function Ss(t,e,n,r,i){var o=new Ao(i),s=new so(n,o,r);return t.Zi((function(){return e.listen(s)})),function(){o.tf(),t.Zi((function(){return e.pu(s)}))}}var Ps=function(){function t(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.Yf=n,this.Jf=r}return t.prototype.Xf=function(t){switch(St(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ut(t.integerValue||t.doubleValue);case 3:return this.Zf(t.timestampValue);case 4:return this.td(t);case 5:return t.stringValue;case 6:return new Ho(qt(t.bytesValue));case 7:return this.ed(t.referenceValue);case 8:return this.nd(t.geoPointValue);case 9:return this.sd(t.arrayValue);case 10:return this.rd(t.mapValue);default:throw v()}},t.prototype.rd=function(t){var e=this,n={};return k(t.fields||{},(function(t,r){n[t]=e.Xf(r)})),n},t.prototype.nd=function(t){return new us(Ut(t.latitude),Ut(t.longitude))},t.prototype.sd=function(t){var e=this;return(t.values||[]).map((function(t){return e.Xf(t)}))},t.prototype.td=function(t){switch(this.Yf){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return kt(n)?t(n):n}(t);return null==e?null:this.Xf(e);case"estimate":return this.Zf(Dt(t));default:return null}},t.prototype.Zf=function(t){var e=Ct(t),n=new L(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.ed=function(t){var e=V.k(t);g(_e(e));var n=new N(e.get(1),e.get(3)),r=new q(e.V(5));return n.isEqual(this.s)||p("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.Jf(r)},t}(),Ls=di.Xo,Os=function(){function t(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new P(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Oo("settings","non-empty string","host",t.host),this.host=t.host,Ro("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(jo("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Ro("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ro("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Ro("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?p("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&p("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Ro("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=di.th;else{if(t.cacheSizeBytes!==Ls&&t.cacheSizeBytes<di.Zo)throw new P(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+di.Zo);this.cacheSizeBytes=t.cacheSizeBytes}Ro("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Rs=function(){function t(e,n,r,o){var s=this;if(void 0===r&&(r=new Io),void 0===o&&(o=new To),this.od=r,this.hd=o,this.ad=null,this.ud=new ci,this.INTERNAL={delete:function(){return i.__awaiter(s,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.ld(),[4,this._d.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof e.options){var u=e;this.ad=u,this.wf=t.fd(u),this.dd=u.name,this.wd=new Ni(n)}else{var a=e;if(!a.projectId)throw new P(S.INVALID_ARGUMENT,"Must provide projectId");this.wf=new N(a.projectId,a.database),this.dd="[DEFAULT]",this.wd=new Ti}this.Td=new Os({})}return Object.defineProperty(t.prototype,"Ed",{get:function(){return this.Id||(this.Id=new ds(this.wf,this.Td.ignoreUndefinedProperties)),this.Id},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){Do("Firestore.settings",arguments,1),Po("Firestore.settings","object",1,t);var e=new Os(t);if(this._d&&!this.Td.isEqual(e))throw new P(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.Td=e,void 0!==e.credentials&&(this.wd=function(t){if(!t)return new Ti;switch(t.type){case"gapi":var e=t.md;return g(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new ki(e,t.aa||"0");case"provider":return t.md;default:throw new P(S.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ld(),this._d.enableNetwork()},t.prototype.disableNetwork=function(){return this.ld(),this._d.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this._d)throw new P(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&p("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new P(S.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Ad(this.od,this.hd,{Q_:!0,cacheSizeBytes:this.Td.cacheSizeBytes,synchronizeTabs:r,Di:i})},t.prototype.clearPersistence=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){if(void 0!==this._d&&!this._d.Hf)throw new P(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new zn,[2,(this.ud.po((function(){return i.__awaiter(e,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.od.clearPersistence(this.wf,this.dd)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"Rd",{get:function(){return this.ld(),this._d.Hf},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.ld(),this._d.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.ld(),No(t))return this._d.Ml(t);Po("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this._d.Ml(e)},t.prototype.ld=function(){return this._d||this.Ad(new Io,new To,{Q_:!1}),this._d},t.prototype.Pd=function(){return new T(this.wf,this.dd,this.Td.host,this.Td.ssl,this.Td.forceLongPolling)},t.prototype.Ad=function(t,e,n){var r=this.Pd();return this._d=new xs(this.wd,this.ud),this._d.start(r,t,e,n)},t.fd=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new P(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new P(S.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new N(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.ad)throw new P(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.ad},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return Do("Firestore.collection",arguments,1),Po("Firestore.collection","non-empty string",1,t),this.ld(),new Ys(V.k(t),this,null)},t.prototype.doc=function(t){return Do("Firestore.doc",arguments,1),Po("Firestore.doc","non-empty string",1,t),this.ld(),Us.gd(V.k(t),this,null)},t.prototype.collectionGroup=function(t){if(Do("Firestore.collectionGroup",arguments,1),Po("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new P(S.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ld(),new Ws(function(t){return new an(V.$(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return Do("Firestore.runTransaction",arguments,1),Po("Firestore.runTransaction","function",1,t),this.ld().transaction((function(n){return t(new Vs(e,n))}))},t.prototype.batch=function(){return this.ld(),new Cs(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(f()){case s.LogLevel.DEBUG:return"debug";case s.LogLevel.ERROR:return"error";case s.LogLevel.SILENT:return"silent";case s.LogLevel.WARN:return"warn";case s.LogLevel.INFO:return"info";case s.LogLevel.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;Do("Firestore.setLogLevel",arguments,1),Co("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),e=t,h.setLogLevel(e)},t.prototype.Vd=function(){return this.Td.timestampsInSnapshots},t}(),Vs=function(){function t(t,e){this.yd=t,this.pd=e}return t.prototype.get=function(t){var e=this;Do("Transaction.get",arguments,1);var n=Js("Transaction.get",t,this.yd);return this.pd.Cf([n.Tf]).then((function(t){if(!t||1!==t.length)return v();var r=t[0];if(r instanceof on)return new Ms(e.yd,n.Tf,null,!1,!1,n.Ef);if(r instanceof rn)return new Ms(e.yd,n.Tf,r,!1,!1,n.Ef);throw v()}))},t.prototype.set=function(t,e,n){So("Transaction.set",arguments,2,3);var r=Js("Transaction.set",t,this.yd);n=Xs("Transaction.set",n);var i=eu(r.Ef,e,n),o=ys(this.yd.Ed,"Transaction.set",r.Tf,i,null!==r.Ef,n);return this.pd.set(r.Tf,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof Xo?(xo("Transaction.update",arguments,3),r=Js("Transaction.update",t,this.yd),i=gs(this.yd.Ed,"Transaction.update",r.Tf,e,n,o)):(Do("Transaction.update",arguments,2),r=Js("Transaction.update",t,this.yd),i=vs(this.yd.Ed,"Transaction.update",r.Tf,e)),this.pd.update(r.Tf,i),this},t.prototype.delete=function(t){Do("Transaction.delete",arguments,1);var e=Js("Transaction.delete",t,this.yd);return this.pd.delete(e.Tf),this},t}(),Cs=function(){function t(t){this.yd=t,this.bd=[],this.vd=!1}return t.prototype.set=function(t,e,n){So("WriteBatch.set",arguments,2,3),this.Sd();var r=Js("WriteBatch.set",t,this.yd);n=Xs("WriteBatch.set",n);var i=eu(r.Ef,e,n),o=ys(this.yd.Ed,"WriteBatch.set",r.Tf,i,null!==r.Ef,n);return this.bd=this.bd.concat(o.If(r.Tf,Ue.We())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Sd(),"string"==typeof e||e instanceof Xo?(xo("WriteBatch.update",arguments,3),r=Js("WriteBatch.update",t,this.yd),i=gs(this.yd.Ed,"WriteBatch.update",r.Tf,e,n,o)):(Do("WriteBatch.update",arguments,2),r=Js("WriteBatch.update",t,this.yd),i=vs(this.yd.Ed,"WriteBatch.update",r.Tf,e)),this.bd=this.bd.concat(i.If(r.Tf,Ue.exists(!0))),this},t.prototype.delete=function(t){Do("WriteBatch.delete",arguments,1),this.Sd();var e=Js("WriteBatch.delete",t,this.yd);return this.bd=this.bd.concat(new $e(e.Tf,Ue.We())),this},t.prototype.commit=function(){return this.Sd(),this.vd=!0,this.bd.length>0?this.yd.ld().write(this.bd):Promise.resolve()},t.prototype.Sd=function(){if(this.vd)throw new P(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Us=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.wf,e,r)||this).Tf=e,i.firestore=n,i.Ef=r,i._d=i.firestore.ld(),i}return i.__extends(e,t),e.gd=function(t,n,r){if(t.length%2!=0)throw new P(S.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.N()+" has "+t.length);return new e(new q(t),n,r)},Object.defineProperty(e.prototype,"id",{get:function(){return this.Tf.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Ys(this.Tf.path.p(),this.firestore,this.Ef)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.Tf.path.N()},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){if(Do("DocumentReference.collection",arguments,1),Po("DocumentReference.collection","non-empty string",1,t),!t)throw new P(S.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=V.k(t);return new Ys(this.Tf.path.child(e),this.firestore,null)},e.prototype.isEqual=function(t){if(!(t instanceof e))throw Bo("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.Tf.isEqual(t.Tf)&&this.Ef===t.Ef},e.prototype.set=function(t,e){So("DocumentReference.set",arguments,1,2),e=Xs("DocumentReference.set",e);var n=eu(this.Ef,t,e),r=ys(this.firestore.Ed,"DocumentReference.set",this.Tf,n,null!==this.Ef,e);return this._d.write(r.If(this.Tf,Ue.We()))},e.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof Xo?(xo("DocumentReference.update",arguments,2),n=gs(this.firestore.Ed,"DocumentReference.update",this.Tf,t,e,r)):(Do("DocumentReference.update",arguments,1),n=vs(this.firestore.Ed,"DocumentReference.update",this.Tf,t)),this._d.write(n.If(this.Tf,Ue.exists(!0)))},e.prototype.delete=function(){return Do("DocumentReference.delete",arguments,0),this._d.write([new $e(this.Tf,Ue.We())])},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];So("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||No(i[u])||(jo("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),Ro("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a={includeMetadataChanges:s.includeMetadataChanges};if(No(i[u])){var c=i[u];i[u]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[u+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[u+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}else Po("DocumentReference.onSnapshot","function",u,i[u]),Lo("DocumentReference.onSnapshot","function",u+1,i[u+1]),Lo("DocumentReference.onSnapshot","function",u+2,i[u+2]);var h={next:function(t){i[u]&&i[u](r.Dd(t))},error:i[u+1],complete:i[u+2]};return this._d.listen(hn(this.Tf.path),a,h)},e.prototype.get=function(t){var e=this;So("DocumentReference.get",arguments,0,1),Zs("DocumentReference.get",t);var n=this.firestore.ld();return t&&"cache"===t.source?n.jf(this.Tf).then((function(t){return new Ms(e.firestore,e.Tf,t,!0,t instanceof rn&&t.Ke,e.Ef)})):n.Kf(this.Tf,t).then((function(t){return e.Dd(t)}))},e.prototype.withConverter=function(t){return new e(this.Tf,this.firestore,t)},e.prototype.Dd=function(t){var e=t.docs.get(this.Tf);return new Ms(this.firestore,this.Tf,e,t.fromCache,t.hasPendingWrites,this.Ef)},e}(cs),qs=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Ms=function(){function t(t,e,n,r,i,o){this.yd=t,this.Tf=e,this.Cd=n,this.Fd=r,this.Nd=i,this.Ef=o}return t.prototype.data=function(t){var e=this;if(So("DocumentSnapshot.data",arguments,0,1),t=$s("DocumentSnapshot.data",t),this.Cd){if(this.Ef){var n=new Fs(this.yd,this.Tf,this.Cd,this.Fd,this.Nd,null);return this.Ef.fromFirestore(n,t)}return new Ps(this.yd.wf,this.yd.Vd(),t.serverTimestamps||"none",(function(t){return new Us(t,e.yd,null)})).Xf(this.Cd.Ze())}},t.prototype.get=function(t,e){var n=this;if(So("DocumentSnapshot.get",arguments,1,2),e=$s("DocumentSnapshot.get",e),this.Cd){var r=this.Cd.data().field(Es("DocumentSnapshot.get",t,this.Tf));if(null!==r)return new Ps(this.yd.wf,this.yd.Vd(),e.serverTimestamps||"none",(function(t){return new Us(t,n.yd,n.Ef)})).Xf(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.Tf.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Us(this.Tf,this.yd,this.Ef)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Cd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new qs(this.Nd,this.Fd)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Bo("isEqual","DocumentSnapshot",1,e);return this.yd===e.yd&&this.Fd===e.Fd&&this.Tf.isEqual(e.Tf)&&(null===this.Cd?null===e.Cd:this.Cd.isEqual(e.Cd))&&this.Ef===e.Ef},t}(),Fs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.data=function(e){return t.prototype.data.call(this,e)},e}(Ms);function js(t,e,n,r,i,o,s){var u;if(i.O()){if("array-contains"===o||"array-contains-any"===o)throw new P(S.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o){zs(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(Gs(r,t,f))}u={arrayValue:{values:a}}}else u=Gs(r,t,s)}else"in"!==o&&"array-contains-any"!==o||zs(s,o),u=ms(n,e,s,"in"===o);var l=In.create(i,o,u);return function(t,e){var n=["array-contains","array-contains-any"],r=["in","array-contains-any"],i=n.indexOf(e.op)>=0,o=r.indexOf(e.op)>=0;if(e.ln()){var s=t.cn();if(null!==s&&!s.isEqual(e.field))throw new P(S.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+s.toString()+"' and '"+e.field.toString()+"'");var u=t.un();null!==u&&Qs(t,e.field,u)}else if(o||i){var a=null;if(o&&(a=t._n(r)),null===a&&i&&(a=t._n(n)),null!==a)throw a===e.op?new P(S.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new P(S.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+a.toString()+"' filters.")}}(t,l),l}function Bs(t,e,n){if(null!==t.startAt)throw new P(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new P(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ln(e,n);return function(t,e){if(null===t.un()){var n=t.cn();null!==n&&Qs(t,n,e.field)}}(t,r),r}function Gs(t,e,n){if("string"==typeof n){if(""===n)throw new P(S.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!fn(e)&&-1!==n.indexOf("/"))throw new P(S.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(V.k(n));if(!q.W(r))throw new P(S.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Mt(t,new q(r))}if(n instanceof cs)return Mt(t,n.Tf);throw new P(S.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Mo(n)+".")}function zs(t,e){if(!Array.isArray(t)||0===t.length)throw new P(S.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new P(S.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new P(S.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new P(S.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}function Qs(t,e,n){if(!n.isEqual(e))throw new P(S.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Ks(t){if(t.an()&&0===t.tn.length)throw new P(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ws=function(){function t(t,e,n){this.kd=t,this.firestore=e,this.Ef=n}return t.prototype.where=function(e,n,r){Do("Query.where",arguments,3),Fo("Query.where",3,r);var i=Co("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,n),o=Es("Query.where",e),s=js(this.kd,"Query.where",this.firestore.Ed,this.firestore.wf,o,i,r);return new t(function(t,e){var n=t.filters.concat([e]);return new an(t.path,t.collectionGroup,t.tn.slice(),n,t.limit,t.en,t.startAt,t.endAt)}(this.kd,s),this.firestore,this.Ef)},t.prototype.orderBy=function(e,n){var r;if(So("Query.orderBy",arguments,1,2),Lo("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new P(S.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=Es("Query.orderBy",e),o=Bs(this.kd,i,r);return new t(function(t,e){var n=t.tn.concat([e]);return new an(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.en,t.startAt,t.endAt)}(this.kd,o),this.firestore,this.Ef)},t.prototype.limit=function(e){return Do("Query.limit",arguments,1),Po("Query.limit","number",1,e),Go("Query.limit",1,e),new t(dn(this.kd,e,"F"),this.firestore,this.Ef)},t.prototype.limitToLast=function(e){return Do("Query.limitToLast",arguments,1),Po("Query.limitToLast","number",1,e),Go("Query.limitToLast",1,e),new t(dn(this.kd,e,"L"),this.firestore,this.Ef)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xo("Query.startAt",arguments,1);var i=this.xd("Query.startAt",e,n,!0);return new t(yn(this.kd,i),this.firestore,this.Ef)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xo("Query.startAfter",arguments,1);var i=this.xd("Query.startAfter",e,n,!1);return new t(yn(this.kd,i),this.firestore,this.Ef)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xo("Query.endBefore",arguments,1);var i=this.xd("Query.endBefore",e,n,!0);return new t(vn(this.kd,i),this.firestore,this.Ef)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xo("Query.endAt",arguments,1);var i=this.xd("Query.endAt",e,n,!1);return new t(vn(this.kd,i),this.firestore,this.Ef)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Bo("isEqual","Query",1,e);return this.firestore===e.firestore&&gn(this.kd,e.kd)&&this.Ef===e.Ef},t.prototype.withConverter=function(e){return new t(this.kd,this.firestore,e)},t.prototype.xd=function(t,e,n,r){if(Fo(t,1,e),e instanceof Ms)return Do(t,i.__spreadArrays([e],n),1),function(t,e,n,r,i){if(!r)throw new P(S.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=ln(t);s<u.length;s++){var a=u[s];if(a.field.O())o.push(Mt(e,r.key));else{var c=r.field(a.field);if(kt(c))throw new P(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.N();throw new P(S.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Dn(o,i)}(this.kd,this.firestore.wf,t,e.Cd,r);var o=[e].concat(n);return function(t,e,n,r,i,o){var s=t.tn;if(i.length>s.length)throw new P(S.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.O()){if("string"!=typeof c)throw new P(S.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!fn(t)&&-1!==c.indexOf("/"))throw new P(S.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(V.k(c));if(!q.W(h))throw new P(S.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new q(h);u.push(Mt(e,f))}else{var l=ms(n,r,c);u.push(l)}}return new Dn(u,o)}(this.kd,this.firestore.wf,this.firestore.Ed,t,o,r)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];So("Query.onSnapshot",arguments,1,4);var s={},u=0;if("object"!=typeof i[u]||No(i[u])||(jo("Query.onSnapshot",s=i[u],["includeMetadataChanges"]),Ro("Query.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++),No(i[u])){var a=i[u];i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}else Po("Query.onSnapshot","function",u,i[u]),Lo("Query.onSnapshot","function",u+1,i[u+1]),Lo("Query.onSnapshot","function",u+2,i[u+2]);var c={next:function(t){i[u]&&i[u](new Hs(r.firestore,r.kd,t,r.Ef))},error:i[u+1],complete:i[u+2]};return Ks(this.kd),this.firestore.ld().listen(this.kd,s,c)},t.prototype.get=function(t){var e=this;So("Query.get",arguments,0,1),Zs("Query.get",t),Ks(this.kd);var n=this.firestore.ld();return(t&&"cache"===t.source?n.Gf(this.kd):n.zf(this.kd,t)).then((function(t){return new Hs(e.firestore,e.kd,t,e.Ef)}))},t}(),Hs=function(){function t(t,e,n,r){this.yd=t,this.$d=e,this.Md=n,this.Ef=r,this.Od=null,this.Ld=null,this.metadata=new qs(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.Md.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.Md.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;So("QuerySnapshot.forEach",arguments,1,2),Po("QuerySnapshot.forEach","function",1,t),this.Md.docs.forEach((function(r){t.call(e,n.qd(r,n.metadata.fromCache,n.Md.Lt.has(r.key)))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new Ws(this.$d,this.yd,this.Ef)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(jo("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ro("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Md.Bt)throw new P(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Od&&this.Ld===e||(this.Od=function(t,e,n){if(t.Ot._()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Lt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Ot;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.Lt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:tu(e.type),doc:r,oldIndex:o,newIndex:s}}))}(this.Md,e,this.qd.bind(this)),this.Ld=e),this.Od},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Bo("isEqual","QuerySnapshot",1,e);return this.yd===e.yd&&gn(this.$d,e.$d)&&this.Md.isEqual(e.Md)&&this.Ef===e.Ef},t.prototype.qd=function(t,e,n){return new Fs(this.yd,t.key,t,e,n,this.Ef)},t}(),Ys=function(t){function e(e,n,r){var i=this;if((i=t.call(this,hn(e),n,r)||this).Bd=e,e.length%2!=1)throw new P(S.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.N()+" has "+e.length);return i}return i.__extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.kd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.kd.path.p();return t._()?null:new Us(new q(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.kd.path.N()},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){So("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=b.t()),Po("CollectionReference.doc","non-empty string",1,t);var e=V.k(t);return Us.gd(this.kd.path.child(e),this.firestore,this.Ef)},e.prototype.add=function(t){Do("CollectionReference.add",arguments,1),Po("CollectionReference.add","object",1,this.Ef?this.Ef.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e}))},e.prototype.withConverter=function(t){return new e(this.Bd,this.firestore,t)},e}(Ws);function Xs(t,e){if(void 0===e)return{merge:!1};if(jo(t,e,["merge","mergeFields"]),Ro(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new P(S.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Mo(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new P(S.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+Mo(r[o]))}(t,"mergeFields",0,r,(function(t){return"string"==typeof t||t instanceof Xo}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new P(S.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function $s(t,e){return void 0===e?{}:(jo(t,e,["serverTimestamps"]),Vo(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Zs(t,e){Lo(t,"object",1,e),e&&(jo(t,e,["source"]),Vo(t,0,"source",e.source,["default","server","cache"]))}function Js(t,e,n){if(e instanceof cs){if(e.firestore!==n)throw new P(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Bo(t,"DocumentReference",1,e)}function tu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return v()}}function eu(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var nu={Firestore:Rs,GeoPoint:us,Timestamp:L,Blob:Ho,Transaction:Vs,WriteBatch:Cs,DocumentReference:Us,DocumentSnapshot:Ms,Query:Ws,QueryDocumentSnapshot:Fs,QuerySnapshot:Hs,CollectionReference:Ys,FieldPath:Xo,FieldValue:os,setLogLevel:Rs.setLogLevel,CACHE_SIZE_UNLIMITED:Ls};function ru(t){!function(t,e){t.INTERNAL.registerComponent(new c.Component("firestore",(function(t){return function(t,e){var n=new To,r=new Eo(n);return new Rs(t,e,r,n)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},nu)))}(t),t.registerVersion("@firebase/firestore","1.16.3")}ru(o),e.__PRIVATE_registerFirestore=ru}).call(this,n("8oxB"))}}]);
//# sourceMappingURL=6a4fd280-39ab637e32130a5e08cc.js.map